(()=>{var a={};a.id=6033,a.ids=[6033],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},36523:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(89843),e=c(72962),f=c(45393);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48106:(a,b,c)=>{"use strict";a.exports=c(44870)},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77320:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>G,patchFetch:()=>F,routeModule:()=>B,serverHooks:()=>E,workAsyncStorage:()=>C,workUnitAsyncStorage:()=>D});var d={};c.r(d),c.d(d,{GET:()=>A,dynamic:()=>z});var e=c(48106),f=c(48819),g=c(12050),h=c(88996),i=c(98730),j=c(261),k=c(36748),l=c(27462),m=c(16318),n=c(93949),o=c(36523),p=c(45393),q=c(41671),r=c(66704),s=c(86439),t=c(65262),u=c(4235),v=c(55682),w=c(83318);let x=(0,v.J1)`
  query DynamicPageBySlug($slug: String!) {
    page(slug: $slug) {
      id
      title
      seoTitle
      seoDescription
      content
      pageType {
        id
        name
        slug
      }
      slug
      isPublished
      publicationDate
      metadata {
        key
        value
      }
    }
    shop {
      id
      metadata {
        key
        value
      }
    }
  }
`;async function y(a){if(!process.env.VERCEL)return console.log("[DEBUG] Build time detected, skipping API call"),null;console.log(`[DEBUG] Fetching page with slug: "${a}"`);let b=process.env.NEXT_PUBLIC_API_URL;if(console.log(`[DEBUG] API URL: ${b}`),!b)return console.warn("[DYNAMIC PAGES] API URL not configured, skipping dynamic page fetch"),null;try{console.log("[DEBUG] Creating Apollo client...");let b=(0,w.A)();console.log("[DEBUG] Apollo client created successfully");let c=new Promise((a,b)=>setTimeout(()=>b(Error("Dynamic page fetch timeout")),5e3)),d=b.query({query:x,variables:{slug:a},fetchPolicy:"network-only",errorPolicy:"ignore"});console.log("[DEBUG] Executing GraphQL query...");let e=await Promise.race([d,c]);console.log("[DEBUG] Query result:",JSON.stringify(e?.data,null,2));let f=e?.data?.page;if(f&&f.isPublished)console.log(`[DEBUG] Successfully fetched published page: "${f.title}"`);else{console.log(`[DEBUG] No published page found for slug: "${a}", checking HTML widgets in metadata...`);let b=e?.data?.shop?.metadata||[];console.log(`[DEBUG] Shop metadata items found: ${b.length}`);let c=null;for(let d of b){let b=function(a,b){let c="html_widget_";if(!a.startsWith(c))return null;try{let d=JSON.parse(b);return{id:a.replace(c,""),name:d.name||"",description:d.description||"",slug:d.slug||"",html:d.html||"",javascript:d.javascript||"",css:d.css||"",type:d.type||"WIDGET",isActive:!1!==d.isActive,createdAt:d.createdAt||new Date().toISOString(),updatedAt:d.updatedAt||new Date().toISOString()}}catch(a){return console.error("Failed to parse HTML widget metadata:",a),null}}(d.key,d.value);if(b&&b.slug===a&&b.isActive){c=b,console.log(`[DEBUG] Found matching widget: "${b.name}" with slug: "${b.slug}"`);break}}if(!c)return console.log(`[DEBUG] No matching HTML widget found for slug: "${a}"`),null;f=function(a){let b=a.html||"",c=a.css||"";if(b.includes("<!DOCTYPE html>")||b.includes("<html>")){console.log("[DEBUG] Extracting body content from full HTML document");let d=b.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(d&&(b=d[1],console.log(`[DEBUG] Extracted body content, length: ${b.length}`)),!a.css||""===a.css.trim()){let b=a.html?.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);b&&(c=b.map(a=>{let b=a.match(/<style[^>]*>([\s\S]*?)<\/style>/i);return b?b[1]:""}).join("\n"),console.log(`[DEBUG] Extracted styles from head, length: ${c.length}`))}}let d=c||"",e=`
${b}

${d?`<style>
${d}
</style>`:""}

${a.javascript?`<script>(function() { ${a.javascript} })();</script>`:""}
  `.trim(),f="CALCULATOR"===a.type?"calculator":"LANDING_PAGE"===a.type?"landing":"widget";return{id:`widget_${a.id}`,title:a.name||a.title||"Widget",seoTitle:`${a.name||a.title||"Widget"} | Your Site`,seoDescription:a.description||`${a.name||a.title||"Widget"} - Interactive ${a.type?.toLowerCase()||"widget"}`,content:e,pageType:{id:`type_${a.type||"widget"}`,name:a.type||"widget",slug:f},slug:a.slug||`widget-${a.id}`,isPublished:a.isActive??!0,publicationDate:a.createdAt||null,metadata:[{key:"widgetType",value:a.type||"widget"},{key:"widgetId",value:a.id||"unknown"},{key:"isHtmlWidget",value:"true"},{key:"pageType",value:f}],excerpt:a.description||""}}(c),console.log(`[DEBUG] Converted widget to page data: "${f.title}"`)}if(f.content){let a=f.content.replace(/<[^>]*>/g,"");f.excerpt=a.substring(0,160)+(a.length>160?"...":"")}return f}catch(b){return console.error(`[DEBUG] Failed to fetch dynamic page by slug "${a}":`,b instanceof Error?b.message:"Unknown error"),console.error("[DEBUG] Full error details:",JSON.stringify(b,null,2)),null}}let z="force-dynamic";async function A(a,{params:b}){try{let{slug:a}=await b;console.log(`[API] Fetching dynamic page: ${a}`);let c=await y(a);if(!c)return u.NextResponse.json({error:"Page not found"},{status:404});return u.NextResponse.json(c)}catch(a){return console.error("[API] Error fetching dynamic page:",a),u.NextResponse.json({error:"Internal server error"},{status:500})}}let B=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/dynamic-page/[slug]/route",pathname:"/api/dynamic-page/[slug]",filename:"route",bundlePath:"app/api/dynamic-page/[slug]/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/arslankhan/Sites/projects/saleor-store-front/wsm-base-template/apps/example-tenant/src/app/api/dynamic-page/[slug]/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:C,workUnitAsyncStorage:D,serverHooks:E}=B;function F(){return(0,g.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:D})}async function G(a,b,c){var d;let e="/api/dynamic-page/[slug]/route";"/index"===e&&(e="/");let g=await B.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[E]||y.routes[D]);if(F&&!x){let a=!!y.routes[D],b=y.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||B.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===B.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>B.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>B.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await B.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await B.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await B.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},80408:()=>{},83318:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(76299),e=c(12899),f=c(61428);let g=()=>{try{let a=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api/graphql";console.log(`[APOLLO] Creating client with URL: ${a}`);let b=(a=>{let b=a.trim(),c=b.toLowerCase();return c.endsWith("/graphql")||c.endsWith("/graphql/")||(b=b.replace(/\/+$/,"")+"/graphql/"),b})(a);console.log(`[APOLLO] Normalized URL: ${b}`);let c=(0,d.$)({uri:b}),g=new e.R({link:c,cache:new f.D,ssrMode:!0,defaultOptions:{query:{errorPolicy:"ignore",fetchPolicy:"no-cache"}}});return console.log("[APOLLO] Client created successfully"),g}catch(b){console.error("[APOLLO] Failed to create Apollo client:",b);let a=(0,d.$)({uri:"http://localhost:3000/api/graphql"});return new e.R({link:a,cache:new f.D,ssrMode:!0})}}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87032:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[3355,9399],()=>b(b.s=77320));module.exports=c})();