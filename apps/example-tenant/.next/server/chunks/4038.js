"use strict";exports.id=4038,exports.ids=[4038],exports.modules={5926:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(60159);let e=()=>{let a=(0,d.useRef)(null),b=(0,d.useCallback)(async()=>{if(!a.current)return console.warn("reCAPTCHA ref not available"),null;try{return await a.current.executeAsync()}catch(a){return console.error("reCAPTCHA execution failed:",a),null}},[]),c=(0,d.useCallback)(()=>{a.current&&a.current.reset()},[]);return{recaptchaRef:a,getRecaptchaToken:b,resetRecaptcha:c}}},54038:(a,b,c)=>{c.r(b),c.d(b,{default:()=>o});var d=c(13486),e=c(60159),f=c(4308),g=c(5926),h=c(76263),i=c(40),j=c(93283);let k=(0,j.J1)`
  query GetCheckoutQuestions {
    page(slug: "checkout-question") {
      id
      title
      slug
      content
      seoTitle
      seoDescription
      isPublished
      metadata {
        key
        value
      }
    }
  }
`,l=(0,j.J1)`
  mutation UpdateCheckoutMetadata($id: ID!, $input: [MetadataInput!]!) {
    updateMetadata(id: $id, input: $input) {
      item {
        ... on Checkout {
          id
          token
          metadata {
            key
            value
          }
        }
      }
      errors {
        field
        message
      }
    }
  }
`;var m=c(62693);function n({question:a,value:b,onChange:c,error:e}){let f=`question-${a.id}`,g=`${f}-error`,h=`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-[var(--color-primary-500)] focus:border-[var(--color-primary-500)] transition-colors ${e?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 hover:border-gray-400"}`;return"text"===a.type?(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("label",{htmlFor:f,className:"block text-sm font-medium text-gray-700",children:[a.question,a.required&&(0,d.jsx)("span",{className:"text-red-500 ml-1","aria-hidden":"true",children:"*"}),a.required&&(0,d.jsx)("span",{className:"sr-only",children:" (required)"})]}),(0,d.jsx)("textarea",{id:f,value:b,onChange:a=>c(a.target.value),className:`${h} min-h-[80px] outline-none resize-vertical`,placeholder:`Enter your answer${a.required?" (required)":""}`,required:a.required,"aria-required":a.required,"aria-invalid":e?"true":void 0,"aria-describedby":e?g:void 0}),e&&(0,d.jsx)("p",{id:g,className:"text-sm text-red-600",role:"alert",children:e})]}):"select"===a.type&&a.options?(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("label",{htmlFor:f,className:"block text-sm font-medium text-gray-700",children:[a.question,a.required&&(0,d.jsx)("span",{className:"text-red-500 ml-1","aria-hidden":"true",children:"*"}),a.required&&(0,d.jsx)("span",{className:"sr-only",children:" (required)"})]}),(0,d.jsxs)("select",{id:f,value:b,onChange:a=>c(a.target.value),className:h,required:a.required,"aria-required":a.required,"aria-invalid":e?"true":void 0,"aria-describedby":e?g:void 0,children:[(0,d.jsxs)("option",{value:"",children:["Please select an option",a.required?" (required)":""]}),a.options.map((a,b)=>(0,d.jsx)("option",{value:a,children:a},b))]}),e&&(0,d.jsx)("p",{id:g,className:"text-sm text-red-600",role:"alert",children:e})]}):"radio"===a.type&&a.options?(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("fieldset",{"aria-invalid":e?"true":void 0,"aria-describedby":e?g:void 0,children:[(0,d.jsxs)("legend",{className:"block text-sm font-medium text-gray-700",children:[a.question,a.required&&(0,d.jsx)("span",{className:"text-red-500 ml-1","aria-hidden":"true",children:"*"}),a.required&&(0,d.jsx)("span",{className:"sr-only",children:" (required)"})]}),(0,d.jsx)("div",{className:"mt-2 space-y-2",role:"radiogroup","aria-required":a.required,children:a.options.map((e,g)=>(0,d.jsxs)("label",{className:`flex items-center gap-3 ring-1 p-3 cursor-pointer rounded transition-colors ${b===e?"ring-[var(--color-primary-100)] bg-[var(--color-primary-50)] text-[var(--color-primary-700)]":"ring-gray-300 hover:bg-gray-50"}`,children:[(0,d.jsx)("input",{type:"radio",name:f,value:e,checked:b===e,onChange:a=>c(a.target.value),className:"h-4 w-4 text-[var(--color-primary-600)] border-gray-300 focus:ring-[var(--color-primary-500)] accent-[var(--color-primary-600)]",required:a.required}),(0,d.jsx)("span",{className:"text-sm flex-1",children:e})]},g))})]}),e&&(0,d.jsx)("p",{id:g,className:"text-sm text-red-600 mt-2",role:"alert",children:e})]}):null}function o({isLoggedIn:a,grandTotal:b,checkoutId:c,onQuestionsChange:j,onValidationChange:o,onSaveQuestions:p}){let{data:q,loading:r,error:s}=(0,f.IT)(k,{fetchPolicy:"cache-first"}),[t,u]=(0,e.useState)({}),[v,w]=(0,e.useState)({}),[x,y]=(0,e.useState)(!1),[z,A]=(0,e.useState)(null),{recaptchaRef:B,getRecaptchaToken:C,resetRecaptcha:D}=(0,g.V)(),E=(0,i.h)();(0,e.useRef)(o);let[F]=(0,m.n)(l),G=(0,e.useMemo)(()=>q?function(a){if(!a?.page||!a.page.isPublished)return null;let b=a.page.metadata,c=[],d=!1,e=null,f=!1;return b.forEach(({key:a,value:b})=>{if("guest_only"===a)d="true"===b;else if("order_value"===a){let a=parseFloat(b);e=isNaN(a)?null:a}else if("reCAPTCHA"===a)f="true"===b;else if(a.startsWith("question-")){let d=b.split(":");if(d.length>=2){let b,e=d[0].trim(),f=d[1].trim();d.length>2&&d[2].trim()&&(b=d[2].split(",").map(a=>a.trim()).filter(a=>a.length>0)),f&&c.push({id:a,required:"r"===e,question:f,options:b,type:b&&b.length>0?b.length<=4?"radio":"select":"text"})}}}),{isPublished:a.page.isPublished,guestOnly:d,orderValueThreshold:e,showReCAPTCHA:f,questions:c.sort((a,b)=>a.id.localeCompare(b.id))}}(q):null,[q]);(0,e.useCallback)(async()=>{if(!c||!G?.questions.length)return void console.log("[CheckoutQuestions] No checkout ID or questions to save");let a=[];if(G.questions.forEach((b,c)=>{let d=c+1,e=t[b.id]?.trim()||"";a.push({key:`question-${d}`,value:b.question},{key:`answer-${d}`,value:e})}),0===a.length)return void console.log("[CheckoutQuestions] No answers to save");try{let b=await F({variables:{id:c,input:a}});if(b.data?.updateMetadata?.errors?.length){let a=b.data.updateMetadata.errors[0].message;throw console.error("[CheckoutQuestions] Error saving questions:",a),Error(`Failed to save questions: ${a}`)}console.log("[CheckoutQuestions] Questions saved successfully")}catch(a){throw console.error("[CheckoutQuestions] Error saving questions:",a),a}},[c,G,t,F]);let H=(0,e.useCallback)(()=>!!G?.isPublished&&(!G.guestOnly||!a)&&(!G.orderValueThreshold||!(b<G.orderValueThreshold)),[G,a,b]),I=(0,e.useCallback)(()=>{if(!G)return!0;let a={},b=!1;return G.questions.forEach(c=>{let d=t[c.id]?.trim()||"";c.required&&!d&&(a[c.id]="This field is required",b=!0)}),G.showReCAPTCHA&&!z&&(a.recaptcha="Please complete the reCAPTCHA verification",b=!0),!b},[G,t,z]),J=(0,e.useCallback)((a,b)=>{u(c=>({...c,[a]:b})),w(b=>{if(b[a]){let c={...b};return delete c[a],c}return b})},[]),K=async a=>{if(a.preventDefault(),I()){y(!0);try{if(G?.showReCAPTCHA&&!await C())throw D(),Error("reCAPTCHA verification failed. Please try again.");console.log("Checkout questions answers:",t),G?.showReCAPTCHA&&D()}catch(a){console.error("Failed to submit checkout questions:",a),G?.showReCAPTCHA&&D()}finally{y(!1)}}};return r?(0,d.jsx)("div",{className:"space-y-6",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-base font-semibold font-secondary text-[var(--color-secondary-800)] mb-3 uppercase",children:"Questions"}),(0,d.jsx)("p",{className:"text-sm text-[var(--color-secondary-600)]",children:"Loading questions..."})]})}):H()&&G?s?(console.warn("Failed to load checkout questions:",s),(0,d.jsx)("div",{className:"space-y-6",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-base font-semibold font-secondary text-[var(--color-secondary-800)] mb-3 uppercase",children:"Questions"}),(0,d.jsx)("div",{className:"text-sm text-red-600 bg-red-50 border border-red-200 rounded p-3",children:(0,d.jsxs)("p",{children:["Error loading questions: ",s.message]})})]})})):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-base font-semibold font-secondary text-gray-800 mb-3 md:mb-5 uppercase",children:"Questions"}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Please answer the following questions to help us improve your experience."})]}),(0,d.jsxs)("form",{onSubmit:K,className:"space-y-6",children:[G.questions.map(a=>(0,d.jsx)(n,{question:a,value:t[a.id]||"",onChange:b=>J(a.id,b),error:v[a.id]},a.id)),G.showReCAPTCHA&&(0,d.jsxs)("div",{className:"flex flex-col items-start py-4",children:[(0,d.jsx)(h.A,{ref:B,sitekey:E.getGoogleRecaptchaConfig()?.site_key||"",theme:"light",size:"normal",onChange:a=>{A(a),a&&v.recaptcha&&w(a=>{let b={...a};return delete b.recaptcha,b})},onExpired:()=>{A(null),D()},onError:()=>{A(null),D()}}),v.recaptcha&&(0,d.jsx)("p",{className:"text-red-500 text-xs mt-2 text-center",children:v.recaptcha})]})]})]}):null}}};