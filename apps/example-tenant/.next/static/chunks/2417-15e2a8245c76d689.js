"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2417],{53706:(e,t,n)=>{n.d(t,{cn:()=>c,m_:()=>r});var o=n(32987),a=n(60607);function c(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.QP)((0,o.$)(t))}function r(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://")||e.endsWith("/no-image-avail-large.png"))return e;let t=e.startsWith("/")?e.slice(1):e;return"".concat("https://wsm-saleor-assets.s3.us-west-2.amazonaws.com","/").concat(t)}},64026:(e,t,n)=>{n.d(t,{A:()=>s,o:()=>u});var o=n(91326),a=n(35313),c=n(68456),r=n(24338);let i=e=>({totalItems:e.reduce((e,t)=>e+t.quantity,0),totalAmount:e.reduce((e,t)=>e+t.price*t.quantity,0)});async function l(){try{for(let e of["token","refreshToken","wsm-global-store","user","auth","session","apollo-cache-persist","apollo-cache"])try{localStorage.removeItem(e)}catch(e){}try{sessionStorage.clear()}catch(e){}try{let e=window.indexedDB;if("function"==typeof(null==e?void 0:e.databases)){let t=await e.databases();await Promise.all(t.map(e=>null==e?void 0:e.name).filter(e=>!!e).map(t=>new Promise(n=>{let o=e.deleteDatabase(t);o.onsuccess=()=>n(),o.onerror=()=>n()})))}}catch(e){}try{await fetch("/api/auth/clear",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},cache:"no-store",redirect:"manual"})}catch(e){console.log(e)}try{var e,t;let n=window;await (null==(t=n.__APOLLO_CLIENT__)||null==(e=t.clearStore)?void 0:e.call(t))}catch(e){}try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}}catch(e){}}catch(e){}}let u=(0,o.v)()((0,a.Zr)(e=>({isLoggedIn:!1,user:null,hydrated:!1,guestEmail:"",guestShippingInfo:{firstName:"",lastName:"",address:"",city:"",state:"",zipCode:"",country:"",phone:""},cartItems:[],totalItems:0,totalAmount:0,checkoutId:null,checkoutToken:null,selectedShippingMethodId:null,syncingCart:!1,isYMMActive:!1,ymmYears:[],ymmYearsLoaded:!1,login:t=>{e({isLoggedIn:!0,user:t}),setTimeout(()=>{u.getState().loadCartFromSaleor().catch(console.error)},100)},logout:async()=>{let t=u.getState(),n=t.checkoutId,o=t.checkoutToken;e({isLoggedIn:!1,user:null,cartItems:[],totalItems:0,totalAmount:0,checkoutId:null,checkoutToken:null,selectedShippingMethodId:null,guestEmail:"",guestShippingInfo:{firstName:"",lastName:"",address:"",city:"",state:"",zipCode:"",country:"",phone:""}}),await l();let a=window.location.pathname,c=a.includes("/checkout")||a.includes("/cart");if(n&&c)try{localStorage.setItem("checkoutId",n),o&&localStorage.setItem("checkoutToken",o)}catch(e){}else try{localStorage.removeItem("checkoutId"),localStorage.removeItem("checkoutToken"),localStorage.removeItem("selectedShippingMethodId")}catch(e){}window.location.replace("/")},initAuthFromToken:()=>{try{let t=!!localStorage.getItem("token");e({isLoggedIn:t}),t&&setTimeout(()=>{u.getState().loadCartFromSaleor().catch(console.error)},500)}catch(t){e({isLoggedIn:!1,user:null})}},setHydrated:t=>e({hydrated:t}),setGuestEmail:t=>e({guestEmail:t}),setGuestShippingInfo:t=>e(e=>({guestShippingInfo:{...e.guestShippingInfo,...t}})),addToCart:async t=>{let n=u.getState();if(r.env.NEXT_PUBLIC_API_URL)try{var o,a,l,s,d,h,k,m;{let u=localStorage.getItem("token"),g=n.checkoutId;if(g){let o=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer ".concat(u)}},body:JSON.stringify({query:c.tK,variables:{id:g,lines:[{variantId:t.id,quantity:t.quantity}]}})});if(o.ok){let t=await o.json(),a=null==t||null==(h=t.data)||null==(d=h.checkoutLinesAdd)?void 0:d.checkout,c=null==t||null==(m=t.data)||null==(k=m.checkoutLinesAdd)?void 0:k.errors;if((null==c?void 0:c.length)>0)throw Error("GraphQL add to cart errors: ".concat(c.map(e=>e.message).join(", ")));if(a){e({checkoutId:a.id,checkoutToken:a.token});try{localStorage.setItem("checkoutId",a.id),a.token&&localStorage.setItem("checkoutToken",a.token)}catch(e){}n.storeCheckoutInUserMetadata(a.id,a.token).catch(console.error)}}else throw Error("Failed to add item to checkout via GraphQL")}else{let i=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer ".concat(u)}},body:JSON.stringify({query:c.Sr,variables:{input:{channel:"default-channel",lines:[{variantId:t.id,quantity:t.quantity}]}}})});if(i.ok){let t=await i.json(),c=null==t||null==(a=t.data)||null==(o=a.checkoutCreate)?void 0:o.checkout,r=null==t||null==(s=t.data)||null==(l=s.checkoutCreate)?void 0:l.errors;if((null==r?void 0:r.length)>0)throw Error("GraphQL checkout creation errors: ".concat(r.map(e=>e.message).join(", ")));if(c){g=c.id,e({checkoutId:c.id,checkoutToken:c.token});try{localStorage.setItem("checkoutId",c.id),c.token&&localStorage.setItem("checkoutToken",c.token)}catch(e){}n.storeCheckoutInUserMetadata(c.id,c.token).catch(console.error)}}else throw Error("Failed to create checkout via GraphQL")}e(e=>{let n=e.cartItems.find(e=>e.id===t.id)?e.cartItems.map(e=>e.id===t.id?{...e,quantity:e.quantity+t.quantity}:e):[...e.cartItems,t],{totalItems:o,totalAmount:a}=i(n);return{cartItems:n,totalItems:o,totalAmount:a}})}}catch(e){throw console.error(e),e}},removeFromCart:t=>{let n=u.getState();n.checkoutId&&n.syncCartRemovalWithSaleor(t).catch(console.error),e(e=>{let n=e.cartItems.filter(e=>e.id!==t),{totalItems:o,totalAmount:a}=i(n);if(0===n.length){try{localStorage.removeItem("checkoutId"),localStorage.removeItem("checkoutToken")}catch(e){}return{cartItems:n,totalItems:o,totalAmount:a,checkoutId:null,checkoutToken:null}}return{cartItems:n,totalItems:o,totalAmount:a}})},updateQuantity:(t,n)=>{let o=u.getState().cartItems.find(e=>e.id===t),a=(null==o?void 0:o.quantity)||0;e(e=>{let o=e.cartItems.map(e=>e.id===t?{...e,quantity:Math.max(0,n)}:e).filter(e=>e.quantity>0),{totalItems:a,totalAmount:c}=i(o);if(0===o.length){console.log("[Store] Cart is now empty after quantity update, clearing checkout info");try{localStorage.removeItem("checkoutId"),localStorage.removeItem("checkoutToken")}catch(e){}return{cartItems:o,totalItems:a,totalAmount:c,checkoutId:null,checkoutToken:null}}return{cartItems:o,totalItems:a,totalAmount:c}});let c=u.getState();c.checkoutId&&a!==n&&(0===n?c.syncCartRemovalWithSaleor(t).catch(console.error):c.syncCartQuantityWithSaleor(t,n,a).catch(console.error))},clearCart:()=>{try{localStorage.removeItem("checkoutId"),localStorage.removeItem("checkoutToken")}catch(e){}e({cartItems:[],totalItems:0,totalAmount:0,checkoutId:null,checkoutToken:null})},setCheckoutId:t=>e({checkoutId:t}),setCheckoutToken:t=>e({checkoutToken:t}),setSelectedShippingMethodId:t=>e({selectedShippingMethodId:t}),setSyncingCart:t=>e({syncingCart:t}),setIsYMMActive:t=>e({isYMMActive:t}),checkYMMStatus:async()=>{try{let t=r.env.NEXT_PUBLIC_PARTSLOGIC_URL;if(!t)return void e({isYMMActive:!1});let n=await fetch("".concat(t,"/api/ping"),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},cache:"no-store"});if(n.ok){let t=await n.json(),o="pong"===t.message;e({isYMMActive:o}),console.log("YMM API Status:",o?"Active":"Inactive")}else e({isYMMActive:!1}),console.log("YMM API Status: Inactive (failed to fetch)")}catch(t){e({isYMMActive:!1}),console.error("Failed to check YMM status:",t)}},loadYMMYears:async()=>{try{let t=r.env.NEXT_PUBLIC_PARTSLOGIC_URL;if(!t)return;let n=await fetch("".concat(t,"/api/fitment-search/root-types"),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},cache:"no-store"});if(n.ok){let t=await n.json();t&&(e({ymmYears:t.data,ymmYearsLoaded:!0}),console.log("YMM Years loaded:",t.data.length))}}catch(e){console.error("Failed to load YMM years:",e)}},loadCartFromSaleor:async()=>{let t=u.getState();if(t.isLoggedIn)try{var n,o;t.setSyncingCart(!0);let a=localStorage.getItem("token");if(!a)return;let c=await t.loadCheckoutFromUserMetadata();if(!c)return;let l=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}},body:JSON.stringify({query:"\n                query GetCheckoutDetails($id: ID!) {\n                  checkout(id: $id) {\n                    id\n                    token\n                    totalPrice { gross { amount currency } }\n                    subtotalPrice { gross { amount currency } }\n                    lines {\n                      id\n                      quantity\n                      totalPrice { gross { amount currency } }\n                      variant {\n                        id\n                        name\n                        sku\n                        product {\n                          name\n                          thumbnail { url }\n                          pricing {\n                            discount { gross { amount currency } }\n                          }\n                        }\n                        pricing {\n                          price { gross { amount currency } }\n                        }\n                      }\n                    }\n                  }\n                }\n              ",variables:{id:c}})});if(!l.ok)throw Error("Failed to fetch checkout");let u=await l.json(),s=null==u||null==(n=u.data)?void 0:n.checkout;if(s&&(null==(o=s.lines)?void 0:o.length)>0){console.log("Found checkout with",s.lines.length,"items");let t=s.lines.map(e=>{var t,n,o,a;let c=Math.max(1,e.quantity),r=null!=(a=null==e||null==(n=e.totalPrice)||null==(t=n.gross)?void 0:t.amount)?a:0,i=r/c;return console.log("[Store] Using line total price for ".concat(e.variant.name,": $").concat(r," / ").concat(c," = $").concat(i," per unit")),{id:e.variant.id,name:e.variant.product.name,price:i,image:(null==(o=e.variant.product.thumbnail)?void 0:o.url)||"",quantity:c,sku:e.variant.sku||void 0}}),{totalItems:n,totalAmount:o}=i(t);e({cartItems:t,totalItems:n,totalAmount:o,checkoutId:s.id,checkoutToken:s.token});try{localStorage.setItem("checkoutId",s.id),s.token&&localStorage.setItem("checkoutToken",s.token)}catch(e){}}else console.log("No items found in checkout or checkout is empty")}catch(t){if(console.error("Failed to load cart from Saleor:",t),t instanceof Error&&t.message.includes("not found"))try{localStorage.removeItem("checkoutId"),localStorage.removeItem("checkoutToken"),e({checkoutId:null,checkoutToken:null})}catch(e){}}finally{t.setSyncingCart(!1)}},syncCartWithSaleor:async()=>{let t=u.getState();if(0!==t.cartItems.length)try{var n,o,a,i,l,s,d,h;t.setSyncingCart(!0);let u=localStorage.getItem("token");if(!u)return;let k=t.cartItems[t.cartItems.length-1];if(!k)return;let m=t.checkoutId;if(m){let n=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer ".concat(u)}},body:JSON.stringify({query:c.tK,variables:{id:m,lines:[{variantId:k.id,quantity:k.quantity}]}})});if(n.ok){let o=await n.json(),a=null==o||null==(s=o.data)||null==(l=s.checkoutLinesAdd)?void 0:l.checkout,c=null==o||null==(h=o.data)||null==(d=h.checkoutLinesAdd)?void 0:d.errors;if((null==c?void 0:c.length)>0)throw Error("GraphQL add to cart errors: ".concat(c.map(e=>e.message).join(", ")));if(a){e({checkoutId:a.id,checkoutToken:a.token});try{localStorage.setItem("checkoutId",a.id),a.token&&localStorage.setItem("checkoutToken",a.token)}catch(e){}t.isLoggedIn&&t.storeCheckoutInUserMetadata(a.id,a.token).catch(console.error),console.log("Synced item to existing checkout via GraphQL:",k.name)}}else throw Error("Failed to add item to checkout via GraphQL")}else{let l=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer ".concat(u)}},body:JSON.stringify({query:c.Sr,variables:{input:{channel:"default-channel",lines:[{variantId:k.id,quantity:k.quantity}]}}})});if(l.ok){let c=await l.json(),r=null==c||null==(o=c.data)||null==(n=o.checkoutCreate)?void 0:n.checkout,u=null==c||null==(i=c.data)||null==(a=i.checkoutCreate)?void 0:a.errors;if((null==u?void 0:u.length)>0)throw Error("GraphQL checkout creation errors: ".concat(u.map(e=>e.message).join(", ")));if(r){m=r.id,e({checkoutId:r.id,checkoutToken:r.token});try{localStorage.setItem("checkoutId",r.id),r.token&&localStorage.setItem("checkoutToken",r.token)}catch(e){}t.isLoggedIn&&t.storeCheckoutInUserMetadata(r.id,r.token).catch(console.error),console.log("Synced item to checkout via GraphQL:",k.name)}}else throw Error("Failed to create checkout via GraphQL")}}catch(e){console.error("Failed to sync cart with GraphQL:",e)}finally{t.setSyncingCart(!1)}},storeCheckoutInUserMetadata:async(e,t)=>{if(u.getState().isLoggedIn)try{let a=localStorage.getItem("token");if(!a)return;let c=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}},body:JSON.stringify({query:"\n                mutation AccountUpdate($input: AccountInput!) {\n                  accountUpdate(input: $input) {\n                    user {\n                      id\n                      metadata {\n                        key\n                        value\n                      }\n                    }\n                    errors {\n                      field\n                      message\n                    }\n                  }\n                }\n              ",variables:{input:{metadata:[{key:"activeCheckoutId",value:e},...t?[{key:"activeCheckoutToken",value:t}]:[]]}}})});if(c.ok){var n,o;let e=await c.json(),t=null==e||null==(o=e.data)||null==(n=o.accountUpdate)?void 0:n.errors;(null==t?void 0:t.length)>0?console.error("Failed to store checkout in user metadata:",t):console.log("Checkout ID stored in user metadata")}}catch(e){console.error("Failed to store checkout in user metadata:",e)}},loadCheckoutFromUserMetadata:async()=>{if(!u.getState().isLoggedIn)return null;try{let n=localStorage.getItem("token");if(!n)return null;let o=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},body:JSON.stringify({query:"\n                query GetUserWithCheckout {\n                  me {\n                    id\n                    metadata {\n                      key\n                      value\n                    }\n                  }\n                }\n              "})});if(o.ok){var e,t;let n=await o.json(),a=(null==n||null==(t=n.data)||null==(e=t.me)?void 0:e.metadata)||[],c=a.find(e=>"activeCheckoutId"===e.key),r=a.find(e=>"activeCheckoutToken"===e.key);if(null==c?void 0:c.value)return console.log("Found checkout ID in user metadata:",c.value),localStorage.setItem("checkoutId",c.value),(null==r?void 0:r.value)&&localStorage.setItem("checkoutToken",r.value),c.value}}catch(e){console.error("Failed to load checkout from user metadata:",e)}return null},finalizeCheckoutCleanup:async()=>{let t=u.getState();t.clearCart(),e({checkoutId:null,checkoutToken:null,selectedShippingMethodId:null}),t.isLoggedIn||e({guestEmail:"",guestShippingInfo:{firstName:"",lastName:"",address:"",city:"",state:"",zipCode:"",country:"",phone:""}}),console.log("Clearing shipping method selection for fresh start");try{localStorage.removeItem("checkoutId"),localStorage.removeItem("checkoutToken"),localStorage.removeItem("selectedShippingMethodId"),localStorage.removeItem("pendingCheckoutId"),localStorage.removeItem("pendingTransactionId")}catch(e){}try{sessionStorage.removeItem("checkoutId"),sessionStorage.removeItem("transactionId")}catch(e){}try{let e=localStorage.getItem("token");e&&await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}},body:JSON.stringify({query:"\n                  mutation AccountUpdate($input: AccountInput!) {\n                    accountUpdate(input: $input) {\n                      user { id }\n                      errors { field message }\n                    }\n                  }\n                ",variables:{input:{metadata:[{key:"activeCheckoutId",value:""},{key:"activeCheckoutToken",value:""}]}}})})}catch(e){console.warn("[checkout cleanup] failed to clear user metadata",e)}},syncCartQuantityWithSaleor:async(e,t,n)=>{let o=u.getState();if(o.checkoutId)try{let l=localStorage.getItem("token");if(0===t)return void await o.syncCartRemovalWithSaleor(e);let u=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...l&&{Authorization:"Bearer ".concat(l)}},body:JSON.stringify({query:c.VZ,variables:{id:o.checkoutId,lines:[{variantId:e,quantity:t}]}})});if(u.ok){var a,i;let o=await u.json(),c=null==o||null==(i=o.data)||null==(a=i.checkoutLinesUpdate)?void 0:a.errors;(null==c?void 0:c.length)>0?console.error("Checkout quantity update errors:",c):console.log("Updated quantity for variant ".concat(e,": ").concat(n," â†’ ").concat(t))}else console.error("Failed to update quantity in Saleor checkout")}catch(e){console.error("Failed to sync quantity with Saleor:",e)}},syncCartRemovalWithSaleor:async e=>{let t=u.getState();if(t.checkoutId)try{var n,o,a;let i=localStorage.getItem("token"),l=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)}},body:JSON.stringify({query:"\n                query GetCheckoutLines($id: ID!) {\n                  checkout(id: $id) {\n                    id\n                    lines {\n                      id\n                      variant { id }\n                    }\n                  }\n                }\n              ",variables:{id:t.checkoutId}})});if(!l.ok)throw Error("Failed to fetch checkout lines");let u=await l.json(),s=null==u||null==(n=u.data)?void 0:n.checkout;if(!(null==s?void 0:s.lines))return void console.error("No checkout lines found");let d=s.lines.find(t=>t.variant.id===e);if(!d)return void console.error("No checkout line found for variant ".concat(e));let h=await fetch(r.env.NEXT_PUBLIC_API_URL||"/api/graphql",{method:"POST",headers:{"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)}},body:JSON.stringify({query:c.$t,variables:{id:t.checkoutId,linesIds:[d.id]}})});if(h.ok){let e=await h.json(),t=null==e||null==(a=e.data)||null==(o=a.checkoutLinesDelete)?void 0:o.errors;(null==t?void 0:t.length)>0&&console.error("Checkout line removal errors:",t)}else console.error("Failed to remove checkout line from Saleor")}catch(e){console.error("Failed to sync removal with Saleor:",e)}}}),{name:"wsm-global-store",storage:(0,a.KU)(()=>localStorage)})),s=u},68456:(e,t,n)=>{n.d(t,{$t:()=>s,Sr:()=>r,VZ:()=>u,rt:()=>i,tK:()=>l});var o=n(46590),a=n(26177);function c(){let e=(0,o._)(["\n  query CheckoutById($id: ID!) {\n    checkout(id: $id) {\n      id\n      token\n      availablePaymentGateways {\n        id\n        name\n        config {\n          field\n          value\n        }\n      }\n    }\n  }\n"]);return c=function(){return e},e}let r="\n  mutation CheckoutCreate($input: CheckoutCreateInput!) {\n    checkoutCreate(input: $input) {\n      checkout { \n        id \n        token\n        availablePaymentGateways {\n          id\n          name\n          config {\n            field\n            value\n          }\n        }\n      }\n      errors { field message }\n    }\n  }\n",i=(0,a.J1)(c()),l="\n  mutation CheckoutLinesAdd($id: ID!, $lines: [CheckoutLineInput!]!) {\n    checkoutLinesAdd(id: $id, lines: $lines) {\n      checkout {\n        id\n        token\n        totalPrice { gross { amount currency } }\n        subtotalPrice { gross { amount currency } }\n        lines {\n          id\n          quantity\n          totalPrice { gross { amount currency } }\n          variant {\n            id\n            name\n            sku\n            product {\n              name\n              thumbnail { url }\n            }\n            pricing {\n              price { gross { amount currency } }\n            }\n          }\n        }\n      }\n      errors { field message }\n    }\n  }\n",u="\n  mutation CheckoutLinesUpdate($id: ID!, $lines: [CheckoutLineUpdateInput!]!) {\n    checkoutLinesUpdate(id: $id, lines: $lines) {\n      checkout {\n        id\n        token\n        totalPrice { gross { amount currency } }\n        subtotalPrice { gross { amount currency } }\n        lines {\n          id\n          quantity\n          totalPrice { gross { amount currency } }\n          variant {\n            id\n            name\n            sku\n            product {\n              name\n              thumbnail { url }\n            }\n            pricing {\n              price { gross { amount currency } }\n            }\n          }\n        }\n      }\n      errors { field message }\n    }\n  }\n",s="\n  mutation CheckoutLinesDelete($id: ID!, $linesIds: [ID!]!) {\n    checkoutLinesDelete(id: $id, linesIds: $linesIds) {\n      checkout {\n        id\n        token\n        totalPrice { gross { amount currency } }\n        subtotalPrice { gross { amount currency } }\n        lines {\n          id\n          quantity\n          totalPrice { gross { amount currency } }\n          variant {\n            id\n            name\n            sku\n            product {\n              name\n              thumbnail { url }\n            }\n            pricing {\n              price { gross { amount currency } }\n            }\n          }\n        }\n      }\n      errors { field message }\n    }\n  }\n"}}]);