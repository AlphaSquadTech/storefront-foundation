"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2762],{6678:(e,t,r)=>{r.d(t,{V:()=>n});var a=r(7620);let n=()=>{let e=(0,a.useRef)(null),t=(0,a.useCallback)(async()=>{if(!e.current)return console.warn("reCAPTCHA ref not available"),null;try{return await e.current.executeAsync()}catch(e){return console.error("reCAPTCHA execution failed:",e),null}},[]),r=(0,a.useCallback)(()=>{e.current&&e.current.reset()},[]);return{recaptchaRef:e,getRecaptchaToken:t,resetRecaptcha:r}}},18752:(e,t,r)=>{r.d(t,{F:()=>o});var a=r(46590);function n(){let e=(0,a._)(["\n  mutation UpdateCheckoutMetadata($id: ID!, $input: [MetadataInput!]!) {\n    updateMetadata(id: $id, input: $input) {\n      item {\n        ... on Checkout {\n          id\n          token\n          metadata {\n            key\n            value\n          }\n        }\n      }\n      errors {\n        field\n        message\n      }\n    }\n  }\n"]);return n=function(){return e},e}let o=(0,r(26177).J1)(n())},42762:(e,t,r)=>{r.r(t),r.d(t,{SaleorNativePayment:()=>$});var a,n=r(46590),o=r(54568),i=r(7620),s=r(62942),l=r(21447),c=r(71096),d=r(47633),u=r(83363),p=r(2244),m=r(7078),y=r(71177),h=r(38308),f=r(25414);function g(){}var v=["refetch","reobserve","fetchMore","updateQuery","startPolling","stopPolling","subscribeToMore"],C=["initialFetchPolicy","onCompleted","onError","defaultOptions","partialRefetch","canonizeResults"],x=["query","ssr","client","fetchPolicy","nextFetchPolicy","refetchWritePolicy","errorPolicy","pollInterval","notifyOnNetworkStatusChange","returnPartialData","skipPollAttempt"],P=r(26177);function b(){let e=(0,n._)(["\n  mutation CheckoutComplete($checkoutId: ID!) {\n    checkoutComplete(checkoutId: $checkoutId) {\n      order {\n        id\n        number\n        status\n        total {\n          gross {\n            amount\n            currency\n          }\n        }\n        user {\n          email\n        }\n        lines {\n          id\n          productName\n          variantName\n          quantity\n          totalPrice {\n            gross {\n              amount\n              currency\n            }\n          }\n        }\n      }\n      errors {\n        field\n        message\n        code\n      }\n    }\n  }\n"]);return b=function(){return e},e}let w=(0,P.J1)(b());function A(){let e=(0,n._)(["\n  mutation CheckoutPaymentCreate(\n  $checkoutId: ID!\n  $input: PaymentInput!\n) {\n  checkoutPaymentCreate(\n    checkoutId: $checkoutId\n    input: $input\n  ) {\n    payment {\n      id\n      gateway\n      token\n      creditCard {\n        brand\n        firstDigits\n        lastDigits\n        expMonth\n        expYear\n      }\n      total {\n        amount\n        currency\n      }\n      capturedAmount {\n        amount\n        currency\n      }\n    }\n    errors {\n      field\n      message\n      code\n    }\n  }\n}\n"]);return A=function(){return e},e}let N=(0,P.J1)(A());function k(){let e=(0,n._)(["\n  mutation CheckoutCustomerAttach($checkoutId: ID!, $customerId: ID!) {\n    checkoutCustomerAttach(checkoutId: $checkoutId, customerId: $customerId) {\n      checkout {\n        id\n        token\n        email\n        user {\n          id\n          email\n          firstName\n          lastName\n        }\n      }\n      errors {\n        field\n        message\n        code\n      }\n    }\n  }\n"]);return k=function(){return e},e}let E=(0,P.J1)(k());var j=r(68456),I=r(64026),S=r(6678),M=r(70498),D=r(91942),L=r(57763),R=r(99921),O=r(78604),T=r(35773);function _(e){var t,r,a,n,l;let{checkoutId:c,totalAmount:d,currency:u="USD",onSuccess:p,onError:m,setIsProcessingPayment:y,environment:h="sandbox",userEmail:f,guestEmail:g,termsAccepted:v=!0,termsData:C,onTermsModalOpen:x,onTermsAcceptedChange:P,questionsValid:b=!0}=e,w=(0,s.useRouter)(),[A,N]=(0,i.useState)(!1),[k,E]=(0,i.useState)(null),[j,I]=(0,i.useState)(!1),[S,M]=(0,i.useState)(null),[D,R]=(0,i.useState)(!0),[O,T]=(0,i.useState)(!1),_=(0,i.useRef)(null),V=(0,i.useRef)(!1),H=(0,i.useRef)(!1),F=(0,i.useRef)(!1),U=(0,i.useRef)(!1);if((0,i.useEffect)(()=>{U.current||(async()=>{try{R(!0);let e=await fetch("/api/paypal/get-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,amount:d})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to fetch PayPal configuration (HTTP ".concat(e.status,")"))}let t=await e.json();if(!t.clientId)throw Error("PayPal client ID not configured in the payment app");M({clientId:t.clientId,merchantId:t.merchantId||null,paymentMethodReadiness:t.paymentMethodReadiness}),t.paymentMethodReadiness?console.log("Payment Methods Status:",{"Apple Pay":t.paymentMethodReadiness.applePay?"✓ ENABLED":"✗ DISABLED","Google Pay":t.paymentMethodReadiness.googlePay?"✓ ENABLED":"✗ DISABLED","PayPal Buttons":t.paymentMethodReadiness.paypalButtons?"✓ ENABLED":"✗ DISABLED","Card Processing":t.paymentMethodReadiness.advancedCardProcessing?"✓ ENABLED":"✗ DISABLED"}):console.warn("⚠️  Payment method readiness not available - merchant may not have completed onboarding"),U.current=!0}catch(e){E(e instanceof Error?e.message:"Failed to load PayPal configuration")}finally{R(!1)}})()},[c,d]),(0,i.useEffect)(()=>{var e,t;if(null==(t=window.google)||null==(e=t.payments)?void 0:e.api)return void T(!0);let r=document.createElement("script");return r.src="https://pay.google.com/gp/p/js/pay.js",r.async=!0,r.onload=()=>{T(!0)},r.onerror=()=>{console.error("Failed to load Google Pay SDK")},document.head.appendChild(r),()=>{document.head.contains(r)&&document.head.removeChild(r)}},[]),(0,i.useEffect)(()=>{if(!S||D)return;if(window.paypal)return void N(!0);let e=document.createElement("script"),t="https://www.paypal.com/sdk/js?client-id=".concat(S.clientId);return S.merchantId&&(t+="&merchant-id=".concat(S.merchantId)),e.src=t+="&currency=".concat(u,"&intent=capture&components=buttons,applepay,googlepay"),e.async=!0,e.setAttribute("data-partner-attribution-id","bnCode"),e.onload=()=>{N(!0)},e.onerror=()=>{E("Failed to load PayPal payment system. Please check the client ID configuration.")},document.body.appendChild(e),()=>{document.body.contains(e)&&document.body.removeChild(e)}},[S,D,u]),(0,i.useEffect)(()=>{if(!A||!window.paypal||V.current)return;let e=_.current;if(e){if(e.children.length>0){V.current=!0;return}try{window.paypal.Buttons({createOrder:async()=>{y({isModalOpen:!0,paymentProcessingLoading:!0,error:!1,success:!1});try{let e=await fetch("/api/paypal/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,amount:d,currency:u})}),t=await e.json();if(!e.ok||!t.orderId)throw Error(t.error||"Failed to create PayPal order");return t.transactionId&&sessionStorage.setItem("paypal-txn-".concat(c),t.transactionId),t.orderId}catch(e){throw y({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),e instanceof Error?m("Failed to create PayPal order: ".concat(e.message)):m("Failed to create PayPal order"),e}},onApprove:async e=>{I(!0),y({isModalOpen:!0,paymentProcessingLoading:!0,error:!1,success:!1});try{let t=sessionStorage.getItem("paypal-txn-".concat(c)),r=await fetch("/api/paypal/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,orderId:e.orderID,transactionId:t})}),a=await r.json();if(!r.ok||a.error)throw Error(a.error||"Failed to capture payment");let n=a.order;if((null==n?void 0:n.id)&&(null==n?void 0:n.number))y({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!0}),w.push("/order-confirmation?orderId=".concat(n.id,"&orderNumber=").concat(n.number,"&total=").concat(n.total)),p();else throw Error("Order data not found in response")}catch(e){I(!1),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),e instanceof Error?m("Payment capture failed: ".concat(e.message)):m("Payment capture failed")}},onError:()=>{y({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),m("PayPal payment error occurred")},onCancel:()=>{y({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!1})},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal",height:45}}).render("#paypal-button-container").then(()=>{V.current=!0}).catch(()=>{E("Failed to render PayPal buttons")})}catch(e){E("Failed to initialize PayPal buttons")}}},[A,c,d,u,p,m,y,w]),(0,i.useEffect)(()=>{var e;if(!A||!window.paypal||H.current||!(null==S||null==(e=S.paymentMethodReadiness)?void 0:e.applePay))return;let t=document.getElementById("applepay-container");if(t){if(t.children.length>0){H.current=!0;return}H.current=!0;try{if(!window.ApplePaySession||!window.ApplePaySession.canMakePayments()){console.log("Apple Pay not available on this device/browser"),t.style.display="none";return}let e=window.paypal.Applepay();e.config().then(r=>{console.log("Apple Pay configured:",r);let a=document.createElement("button");a.className="apple-pay-button apple-pay-button-black",a.style.cssText="width: 100%; height: 45px; display: block; cursor: pointer; -webkit-appearance: -apple-pay-button; -apple-pay-button-type: plain;",a.addEventListener("click",()=>{try{console.log("Creating Apple Pay payment session...");let t={countryCode:r.countryCode||"US",currencyCode:u,merchantCapabilities:r.merchantCapabilities,supportedNetworks:r.supportedNetworks,total:{label:"Total",type:"final",amount:d.toFixed(2)}};if(!window.ApplePaySession){console.error("ApplePaySession not available"),m("Apple Pay is not available on this device");return}let a=new window.ApplePaySession(4,t);a.onvalidatemerchant=t=>{console.log("Validating merchant..."),e.validateMerchant({validationUrl:t.validationURL,displayName:"Web Shop Manager"}).then(e=>{console.log("✅ Merchant validated"),a.completeMerchantValidation(e.merchantSession)}).catch(e=>{console.error("❌ Merchant validation failed:",e),a.abort(),m("Apple Pay validation failed")})},a.onpaymentauthorized=async t=>{try{console.log("Payment authorized by user"),y({isModalOpen:!0,paymentProcessingLoading:!0,error:!1,success:!1}),console.log("Creating PayPal order...");let r=await fetch("/api/paypal/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,amount:d,currency:u})}),n=await r.json();if(!r.ok||!n.orderId)throw Error(n.error||"Failed to create PayPal order");console.log("✅ PayPal order created:",n.orderId),n.transactionId&&sessionStorage.setItem("paypal-txn-".concat(c),n.transactionId),console.log("Confirming order with PayPal..."),await e.confirmOrder({orderId:n.orderId,token:t.payment.token,billingContact:t.payment.billingContact}),console.log("✅ Order confirmed with PayPal"),window.ApplePaySession&&a.completePayment(window.ApplePaySession.STATUS_SUCCESS),I(!0),console.log("Capturing payment...");let o=sessionStorage.getItem("paypal-txn-".concat(c)),i=await fetch("/api/paypal/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,orderId:n.orderId,transactionId:o})}),s=await i.json();if(!i.ok||s.error)throw Error(s.error||"Failed to capture payment");let l=s.order;if((null==l?void 0:l.id)&&(null==l?void 0:l.number))console.log("✅ Apple Pay payment successful:",l.number),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!0}),w.push("/order-confirmation?orderId=".concat(l.id,"&orderNumber=").concat(l.number,"&total=").concat(l.total)),p();else throw Error("Order data not found in response")}catch(e){console.error("❌ Payment processing error:",e),window.ApplePaySession&&a.completePayment(window.ApplePaySession.STATUS_FAILURE),I(!1),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),e instanceof Error?m("Apple Pay payment failed: ".concat(e.message)):m("Apple Pay payment failed")}},a.oncancel=()=>{console.log("Apple Pay session cancelled by user"),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!1})},a.begin(),console.log("✅ Apple Pay session started")}catch(e){console.error("❌ Apple Pay session error:",e),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),e instanceof Error?m("Apple Pay initialization failed: ".concat(e.message)):m("Apple Pay initialization failed")}}),t.appendChild(a)}).catch(e=>{console.error("Apple Pay not available:",e),t.style.display="none",H.current=!1})}catch(e){console.error("Failed to initialize Apple Pay:",e),t.style.display="none",H.current=!1}}},[A,S,c,d,u,p,m,y,w]),(0,i.useEffect)(()=>{var e,t,r;if(!A||!window.paypal||F.current||!(null==S||null==(e=S.paymentMethodReadiness)?void 0:e.googlePay))return;if(!O||!(null==(r=window.google)||null==(t=r.payments)?void 0:t.api))return void console.log("Google Pay SDK not loaded yet");let a=document.getElementById("googlepay-container");if(a){if(a.children.length>0){F.current=!0;return}F.current=!0;try{let e=window.paypal.Googlepay();e.config().then(async t=>{var r,n;if(console.log("Google Pay configured:",t),!(null==(n=window.google)||null==(r=n.payments)?void 0:r.api)){console.error("Google Pay SDK not available"),a.style.display="none";return}let o=new window.google.payments.api.PaymentsClient({environment:"sandbox"===h?"TEST":"PRODUCTION"}),i={apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:t.allowedPaymentMethods},{result:s}=await o.isReadyToPay(i);if(!s){console.log("Google Pay not available on this device"),a.style.display="none";return}let l=document.createElement("button");l.className="gpay-button",l.style.cssText="width: 100%; height: 45px; background-color: #000; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: 500; display: flex; align-items: center; justify-content: center; font-size: 14px;",l.textContent="Google Pay",l.addEventListener("click",async()=>{try{let r,a;console.log("\uD83D\uDCB3 Showing Google Pay payment sheet...");let n={apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:t.allowedPaymentMethods,merchantInfo:t.merchantInfo,transactionInfo:{totalPriceStatus:"FINAL",totalPrice:d.toFixed(2),currencyCode:u}},i=await o.loadPaymentData(n);console.log("✅ Payment data received from Google Pay"),y({isModalOpen:!0,paymentProcessingLoading:!0,error:!1,success:!1}),console.log("\uD83D\uDCDD Creating PayPal order...");let s=await fetch("/api/paypal/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,amount:d,currency:u})}),l=await s.json();if(!s.ok||!l.orderId)throw Error(l.error||"Failed to create PayPal order");console.log("✅ PayPal order created:",l.orderId),l.transactionId&&sessionStorage.setItem("paypal-txn-".concat(c),l.transactionId),console.log("\uD83D\uDD10 Confirming order with PayPal SDK...");let m=await e.confirmOrder({orderId:l.orderId,paymentMethodData:i.paymentMethodData});if(console.log("✅ PayPal confirm result:",m),"APPROVED"!==m.status&&"COMPLETED"!==m.status)throw Error("Payment was not approved. Status: ".concat(m.status));I(!0),console.log("\uD83D\uDCB0 Capturing payment...");let h=sessionStorage.getItem("paypal-txn-".concat(c)),f=0;for(;f<3;){if(a=await fetch("/api/paypal/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:c,orderId:l.orderId,transactionId:h})}),r=await a.json(),202===a.status&&(null==r?void 0:r.status)==="processing"){console.log("⏳ Order still processing, retrying in ".concat(2e3,"ms... (").concat(f+1,"/").concat(3,")")),await new Promise(e=>setTimeout(e,2e3)),f++;continue}break}if(!a||!a.ok||(null==r?void 0:r.error)){if(a&&202===a.status)throw Error("Your payment is being processed. Please check your email for order confirmation.");throw Error((null==r?void 0:r.error)||"Failed to capture payment")}let g=null==r?void 0:r.order;if((null==g?void 0:g.id)&&(null==g?void 0:g.number))console.log("✅ Order completed successfully:",g.number),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!0}),w.push("/order-confirmation?orderId=".concat(g.id,"&orderNumber=").concat(g.number,"&total=").concat(g.total)),p();else throw Error("Order data not found in response")}catch(e){console.error("❌ Google Pay payment error:",e),I(!1),y({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),e instanceof Error?m("Google Pay payment failed: ".concat(e.message)):m("Google Pay payment failed")}}),a.appendChild(l)}).catch(e=>{console.error("Google Pay not available:",e),a.style.display="none",F.current=!1})}catch(e){console.error("Failed to initialize Google Pay:",e),a.style.display="none",F.current=!1}}},[A,O,S,c,d,u,h,p,m,y,w]),k)return(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,o.jsx)("p",{className:"text-red-700 text-sm",children:k}),(0,o.jsx)("p",{className:"text-red-600 text-xs mt-2",children:"Please refresh the page or contact support."})]});if(D||!S||!A)return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(L.A,{className:"h-32"}),(0,o.jsx)("p",{className:"text-center text-sm text-[var(--color-secondary-600)]",children:D?"Loading PayPal configuration...":"Loading PayPal payment system..."})]});let z=f||g,Y=(null==C||null==(t=C.page)?void 0:t.isPublished)&&!v,B=!b||Y||!z||j;return(0,o.jsxs)("div",{className:"space-y-6",children:[j&&(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(L.A,{className:"h-32"}),(0,o.jsx)("p",{className:"text-center text-sm text-[var(--color-secondary-600)]",children:"Processing payment..."})]}),(0,o.jsxs)("div",{className:j?"hidden":"",children:[!z&&(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,o.jsx)("p",{className:"text-yellow-700 text-sm",children:"Please provide an email address to continue with payment."})}),!b&&(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,o.jsx)("p",{className:"text-yellow-700 text-sm",children:"Please complete all required questions below."})}),(0,o.jsxs)("div",{className:"transition-opacity space-y-3 mb-4 ".concat(B?"opacity-50 pointer-events-none":""),children:[(null==S||null==(r=S.paymentMethodReadiness)?void 0:r.applePay)&&(0,o.jsx)("div",{id:"applepay-container",className:"min-h-[50px]"}),(null==S||null==(a=S.paymentMethodReadiness)?void 0:a.googlePay)&&(0,o.jsx)("div",{id:"googlepay-container",className:"min-h-[50px]"}),(null==S||null==(n=S.paymentMethodReadiness)?void 0:n.paypalButtons)!==!1&&(0,o.jsx)("div",{id:"paypal-button-container",ref:_,className:"min-h-[50px]"})]}),Y&&(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,o.jsx)("p",{className:"text-yellow-700 text-sm",children:"Please accept the Terms and Conditions to continue."})}),(null==C||null==(l=C.page)?void 0:l.isPublished)&&(0,o.jsxs)("div",{className:"flex items-start gap-2 w-full py-2 mb-4",children:[(0,o.jsx)("input",{style:{accentColor:"var(--color-primary-600)"},type:"checkbox",id:"termsAcceptedPayPal",className:"w-5 h-5 cursor-pointer mt-0.5",checked:v,onChange:e=>null==P?void 0:P(e.target.checked)}),(0,o.jsxs)("label",{htmlFor:"termsAcceptedPayPal",style:{color:"var(--color-secondary-600)"},className:"text-sm lg:text-base tracking-[-0.04px] cursor-pointer",children:["I agree to the"," ",(0,o.jsx)("button",{type:"button",onClick:x,className:"font-semibold text-[var(--color-primary-600)] hover:underline focus:underline focus:outline-none",children:"Terms and Conditions"})]})]})]})]})}function V(e){var t,r;let{checkoutId:a,totalAmount:n,currency:l="USD",onSuccess:c,onError:d,setIsProcessingPayment:u,userEmail:p,guestEmail:m,termsAccepted:y=!0,termsData:h,onTermsModalOpen:f,onTermsAcceptedChange:g,questionsValid:v=!0}=e,C=(0,s.useRouter)(),[x,P]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[A,N]=(0,i.useState)(!1),[k,E]=(0,i.useState)(null),[j,I]=(0,i.useState)(!0),S=(0,i.useRef)(!1);(0,i.useEffect)(()=>{S.current||(async()=>{try{I(!0);let e=await fetch("/api/affirm/get-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:a,amount:n})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to fetch Affirm configuration (HTTP ".concat(e.status,")"))}let t=await e.json();if(!t.publicApiKey)throw Error("Affirm public API key not configured in the payment app");E({publicApiKey:t.publicApiKey,environment:t.environment,scriptUrl:t.scriptUrl}),S.current=!0}catch(e){w(e instanceof Error?e.message:"Failed to load Affirm configuration")}finally{I(!1)}})()},[a,n]),(0,i.useEffect)(()=>{if(!k||j)return;if(window.affirm)return void P(!0);let e="production"===k.environment?"https://cdn1.affirm.com/js/v2/affirm.js":"https://cdn1-sandbox.affirm.com/js/v2/affirm.js";window._affirm_config={public_api_key:k.publicApiKey,script:e,locale:"en_US",country_code:"USA"};let t=document.createElement("script");return t.src=e,t.async=!0,t.onload=()=>{console.log("✅ Affirm SDK loaded successfully"),console.log("\uD83D\uDD0D Window.affirm available:",!!window.affirm),P(!0)},t.onerror=()=>{console.error("❌ Failed to load Affirm SDK from:",k.scriptUrl),w("Failed to load Affirm payment system. Please check the configuration.")},document.body.appendChild(t),()=>{document.body.contains(t)&&document.body.removeChild(t)}},[k,j]);let M=async()=>{if(!A)try{N(!0),u({isModalOpen:!0,paymentProcessingLoading:!0,error:!1,success:!1}),console.log("\uD83D\uDE80 Starting Affirm checkout creation..."),console.log("\uD83D\uDCCA Checkout details:",{checkoutId:a,totalAmount:n,currency:l});let e=await fetch("/api/affirm/create-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkoutId:a,amount:n,currency:l})}),t=await e.json();if(!e.ok||!t.checkoutToken)throw console.error("❌ Affirm checkout creation failed:",t),Error(t.error||"Failed to create Affirm checkout");t.transactionId&&sessionStorage.setItem("affirm-txn-".concat(a),t.transactionId);let r=t.checkoutUrl;if(!r)throw console.error("❌ No redirect URL received from Affirm"),Error("No redirect URL received from Affirm");let o=window.open(r,"affirm-checkout","width=600,height=700,scrollbars=yes,resizable=yes");if(!o)throw Error("Failed to open Affirm checkout window. Please allow popups.");let i=setInterval(()=>{o.closed&&(clearInterval(i),N(!1),u({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),d("Your payment was not processed."))},1e3),s=e=>{console.log("\uD83D\uDCE8 Received message:",e.data),"AFFIRM_SUCCESS"===e.data.type&&e.data.order&&(console.log("✅ Received success message from Affirm popup"),clearInterval(i),window.removeEventListener("message",s),o.closed||o.close(),N(!1),u({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!0}),C.push("/order-confirmation?orderId=".concat(e.data.order.id,"&orderNumber=").concat(e.data.order.number,"&total=").concat(e.data.order.total)),c())};console.log("\uD83C\uDFA7 Adding message listener for Affirm popup"),window.addEventListener("message",s)}catch(e){N(!1),u({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),d(e instanceof Error?"Failed to create Affirm checkout: ".concat(e.message):"Failed to create Affirm checkout")}};if(b)return(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,o.jsx)("p",{className:"text-red-700 text-sm",children:b}),(0,o.jsx)("p",{className:"text-red-600 text-xs mt-2",children:"Please refresh the page or contact support."})]});if(j||!k||!x)return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(L.A,{className:"h-32"}),(0,o.jsx)("p",{className:"text-center text-sm text-[var(--color-secondary-600)]",children:j?"Loading Affirm configuration...":"Loading Affirm payment system..."})]});let D=p||m,R=(null==h||null==(t=h.page)?void 0:t.isPublished)&&!y,O=!v||R||!D||A;return(0,o.jsxs)("div",{className:"space-y-6",children:[A&&(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(L.A,{className:"h-32"}),(0,o.jsx)("p",{className:"text-center text-sm text-[var(--color-secondary-600)]",children:"Processing payment..."})]}),(0,o.jsxs)("div",{className:A?"hidden":"",children:[!D&&(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,o.jsx)("p",{className:"text-yellow-700 text-sm",children:"Please provide an email address to continue with payment."})}),!v&&(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,o.jsx)("p",{className:"text-yellow-700 text-sm",children:"Please complete all required questions below."})}),(0,o.jsx)("div",{className:"transition-opacity mb-4 ".concat(O?"opacity-50 pointer-events-none":""),children:(0,o.jsx)("button",{onClick:M,disabled:O,className:"w-full bg-[#4a4af4] hover:bg-[#4646EB] text-white font-medium py-3 px-4 rounded-md transition-colors flex items-center justify-center",children:(0,o.jsxs)("svg",{width:"296",height:"25",viewBox:"0 8 296 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("path",{d:"M44.667 30.939C44.667 26.615 47.473 23.648 51.245 23.648C54.58 23.648 56.627 25.603 57.156 28.432H54.235C53.752 27.144 52.878 26.27 51.245 26.27C48.991 26.27 47.657 28.248 47.657 30.939C47.657 33.607 48.991 35.608 51.245 35.608C52.878 35.608 53.752 34.734 54.235 33.423H57.156C56.627 36.275 54.58 38.23 51.245 38.23C47.473 38.23 44.667 35.263 44.667 30.939ZM59.0106 38V23.05H61.8626V28.662C62.4146 28.018 63.4266 27.489 64.6226 27.489C66.9456 27.489 68.2566 29.007 68.2566 31.284V38H65.4046V31.882C65.4046 30.801 64.8526 30.065 63.7256 30.065C62.8516 30.065 62.0926 30.594 61.8626 31.491V38H59.0106ZM76.8789 34.642H79.5239C79.1559 36.827 77.5459 38.23 74.9699 38.23C71.9799 38.23 69.9789 36.045 69.9789 32.871C69.9789 29.766 72.0489 27.489 74.9239 27.489C77.9369 27.489 79.5929 29.582 79.5929 32.595V33.469H72.7389C72.8309 35.01 73.7049 35.93 74.9699 35.93C75.9359 35.93 76.6489 35.516 76.8789 34.642ZM74.9469 29.812C73.8429 29.812 73.0609 30.479 72.8079 31.744H76.7869C76.7639 30.663 76.1199 29.812 74.9469 29.812ZM80.85 32.871C80.85 29.674 82.874 27.489 85.795 27.489C88.371 27.489 90.004 29.007 90.303 31.192H87.497C87.336 30.41 86.715 29.927 85.795 29.927C84.484 29.927 83.679 31.123 83.679 32.871C83.679 34.596 84.484 35.792 85.795 35.792C86.715 35.792 87.336 35.309 87.497 34.527H90.303C90.004 36.735 88.371 38.23 85.795 38.23C82.874 38.23 80.85 36.045 80.85 32.871ZM98.7436 38L95.7306 33.86L94.9026 34.757V38H92.0506V23.05H94.9026V31.537L98.4216 27.719H101.964L97.8006 32.089L102.125 38H98.7436ZM117.832 32.871C117.832 36.022 115.785 38.23 112.795 38.23C109.805 38.23 107.758 36.022 107.758 32.871C107.758 29.697 109.805 27.489 112.795 27.489C115.785 27.489 117.832 29.697 117.832 32.871ZM115.003 32.871C115.003 31.146 114.221 29.904 112.795 29.904C111.369 29.904 110.587 31.146 110.587 32.871C110.587 34.573 111.369 35.815 112.795 35.815C114.221 35.815 115.003 34.573 115.003 32.871ZM128.763 27.719V38H125.911V37.057C125.336 37.701 124.347 38.23 123.151 38.23C120.851 38.23 119.54 36.712 119.54 34.435V27.719H122.392V33.86C122.392 34.941 122.921 35.677 124.048 35.677C124.922 35.677 125.681 35.148 125.888 34.251V27.719H128.763ZM131.843 34.895V30.019H130.279V27.719H131.843V24.936H134.672V27.719H136.926V30.019H134.672V34.527C134.672 35.332 135.109 35.7 135.845 35.7C136.282 35.7 136.765 35.562 137.087 35.355V37.885C136.696 38.092 136.006 38.207 135.247 38.207C133.154 38.207 131.843 37.172 131.843 34.895ZM151.638 27.719L153.34 34.274L155.18 27.719H157.94L154.812 38H152.19L150.511 31.698L148.832 38H146.21L143.082 27.719H145.934L147.774 34.274L149.453 27.719H151.638ZM162.33 27.719V38H159.478V27.719H162.33ZM162.583 24.752C162.583 25.718 161.801 26.385 160.904 26.385C159.984 26.385 159.202 25.718 159.202 24.752C159.202 23.809 159.984 23.119 160.904 23.119C161.801 23.119 162.583 23.809 162.583 24.752ZM165.445 34.895V30.019H163.881V27.719H165.445V24.936H168.274V27.719H170.528V30.019H168.274V34.527C168.274 35.332 168.711 35.7 169.447 35.7C169.884 35.7 170.367 35.562 170.689 35.355V37.885C170.298 38.092 169.608 38.207 168.849 38.207C166.756 38.207 165.445 37.172 165.445 34.895ZM172.753 38V23.05H175.605V28.662C176.157 28.018 177.169 27.489 178.365 27.489C180.688 27.489 181.999 29.007 181.999 31.284V38H179.147V31.882C179.147 30.801 178.595 30.065 177.468 30.065C176.594 30.065 175.835 30.594 175.605 31.491V38H172.753Z",fill:"white"}),(0,o.jsxs)("g",{clipPath:"url(#clip0_2539_4435)",children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M193.13 36.0613C192.351 36.0613 191.954 35.687 191.954 35.0719C191.954 33.9248 193.266 33.5391 195.657 33.291C195.657 34.8195 194.598 36.0613 193.123 36.0613H193.13ZM194.159 27.4652C192.45 27.4652 190.484 28.2495 189.417 29.0798L190.392 31.0872C191.247 30.3229 192.631 29.6691 193.879 29.6691C195.065 29.6691 195.721 30.0562 195.721 30.8362C195.721 31.3596 195.287 31.6249 194.467 31.7295C191.4 32.1167 188.997 32.9426 188.997 35.2468C188.997 37.0736 190.33 38.1791 192.413 38.1791C193.901 38.1791 195.224 37.3733 195.853 36.3151V37.8923H198.626V31.2836C198.626 28.5593 196.687 27.4595 194.161 27.4595L194.159 27.4652Z",fill:"white"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M221.987 27.7615V37.8789H224.953V33.0037C224.953 30.688 226.391 30.0069 227.392 30.0069C227.843 30.0035 228.285 30.1308 228.661 30.3726L229.203 27.6984C228.783 27.5343 228.333 27.4548 227.88 27.4647C226.356 27.4647 225.397 28.1228 224.765 29.4621V27.7615H221.987Z",fill:"white"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M242.952 27.4648C241.383 27.4648 240.21 28.3682 239.6 29.24C239.034 28.1144 237.836 27.4648 236.395 27.4648C234.828 27.4648 233.742 28.3137 233.241 29.2916V27.7617H230.38V37.8791H233.349V32.6698C233.349 30.8058 234.353 29.9039 235.29 29.9039C236.138 29.9039 236.917 30.4387 236.917 31.8195V37.8791H239.881V32.6698C239.881 30.7785 240.86 29.9039 241.841 29.9039C242.626 29.9039 243.458 30.4602 243.458 31.7994V37.8791H246.421V30.8846C246.421 28.6119 244.853 27.4648 242.958 27.4648",fill:"white"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M214.768 27.7614H212.08V26.7333C212.08 25.394 212.864 25.0126 213.539 25.0126C213.999 25.0185 214.452 25.129 214.862 25.3353L215.776 23.2949C215.776 23.2949 214.848 22.7041 213.162 22.7041C211.267 22.7041 209.111 23.7465 209.111 27.0172V27.7614H204.62V26.7333C204.62 25.394 205.402 25.0126 206.078 25.0126C206.539 25.0126 206.994 25.1234 207.401 25.3353L208.315 23.2949C207.77 22.9837 206.892 22.7041 205.703 22.7041C203.808 22.7041 201.652 23.7465 201.652 27.0172V27.7614H199.935V29.9925H201.656V37.8788H204.62V29.9925H209.117V37.8788H212.08V29.9925H214.768V27.7614Z",fill:"white"}),(0,o.jsx)("path",{d:"M219.498 27.7622H216.538V37.8753H219.498V27.7622Z",fill:"white"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M216.646 26.042H219.547C221.239 20.8529 226.98 16.2917 233.807 16.2917C242.11 16.2917 249.285 22.4574 249.285 32.0557C249.31 34.0259 249.033 35.9887 248.462 37.8787H251.277L251.305 37.784C251.779 35.913 252.013 33.9917 252.002 32.0643C252.002 21.3605 244.005 13.6562 233.813 13.6562C225.807 13.6562 218.671 19.0763 216.648 26.0449L216.646 26.042Z",fill:"white"})]}),(0,o.jsx)("defs",{})]})})}),R&&(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:(0,o.jsx)("p",{className:"text-yellow-700 text-sm",children:"Please accept the Terms and Conditions to continue."})}),(null==h||null==(r=h.page)?void 0:r.isPublished)&&(0,o.jsxs)("div",{className:"flex items-start gap-2 w-full py-2 mb-4",children:[(0,o.jsx)("input",{style:{accentColor:"var(--color-primary-600)"},type:"checkbox",id:"termsAcceptedAffirm",className:"w-5 h-5 cursor-pointer mt-0.5",checked:y,onChange:e=>null==g?void 0:g(e.target.checked)}),(0,o.jsxs)("label",{htmlFor:"termsAcceptedAffirm",style:{color:"var(--color-secondary-600)"},className:"text-sm lg:text-base tracking-[-0.04px] cursor-pointer",children:["I agree to the"," ",(0,o.jsx)("button",{type:"button",onClick:f,className:"font-semibold text-[var(--color-primary-600)] hover:underline focus:underline focus:outline-none",children:"Terms and Conditions"})]})]})]})]})}async function H(){try{let e=await fetch("https://api.ipify.org?format=json");if(e.ok){let t=await e.json();if(t.ip)return t.ip}}catch(e){console.warn("Failed to get IP from ipify:",e)}try{let e=await fetch("https://ipinfo.io/json");if(e.ok){let t=await e.json();if(t.ip)return t.ip}}catch(e){console.warn("Failed to get IP from ipinfo.io:",e)}return"127.0.0.1"}function F(){return Array.from(crypto.getRandomValues(new Uint8Array(16))).map(e=>e.toString(16).padStart(2,"0")).join("")}let U={AFFIRM:"AFFIRM",AFTERPAY:"AFTRPAY",ALIPAY:"ALIPAY",AMAZON_PAY:"AMZN",APPLE_PAY:"APAY",CREDIT_CARD:"CREDIT_CARD",CRYPTO:"CRYPTO",DEBIT_CARD:"DEBIT_CARD",FACEBOOK_PAY:"FBPAY",GIROPAY:"GIROPAY",GOOGLE_CHECKOUT:"GOOG",INTERAC:"INTERAC",KLARNA:"KLARNA",PAYPAL:"PYPL",SAMSUNG_PAY:"SAMPAY",SEPA:"SEPA",SOFORT:"SOFORT",SPLITIT:"SPLIT",WECHAT_PAY:"WCPAY"};var z=r(18752);let Y="production"===r(24338).env.NEXT_PUBLIC_AUTHORIZE_NET_ENV?"https://js.authorize.net/v1/Accept.js":"https://jstest.authorize.net/v1/Accept.js";function B(){let e=(0,n._)(["\n  mutation CheckoutDeliveryMethodUpdate($id: ID!, $deliveryMethodId: ID!) {\n    checkoutDeliveryMethodUpdate(id: $id, deliveryMethodId: $deliveryMethodId) {\n      checkout {\n        id\n        deliveryMethod {\n          ... on ShippingMethod {\n            id\n            name\n          }\n          ... on Warehouse {\n            id\n            name\n          }\n        }\n      }\n      errors {\n        field\n        message\n        code\n      }\n    }\n  }\n"]);return B=function(){return e},e}let G=(0,P.J1)(B()),q=e=>{if("mirumee.payments.authorize_net"===e);else if("saleor.app.payment.stripe"===e)return(0,o.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"#635BFF",children:(0,o.jsx)("path",{d:"M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"})});else if("saleor.app.payment.paypal"===e)return(0,o.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"#00457C",children:(0,o.jsx)("path",{d:"M20.067 8.478c.492.88.556 2.014.3 3.327-.74 3.806-3.276 5.12-6.514 5.12h-.5a.805.805 0 00-.794.68l-.04.22-.63 3.993-.028.15a.806.806 0 01-.795.679H7.72a.483.483 0 01-.477-.558L8.926 14.5h1.513c3.238 0 5.774-1.314 6.514-5.12.145-.746.096-1.433-.204-2.03a2.638 2.638 0 00-.428-.61c-.287.974-.835 1.776-1.637 2.397-1.056.818-2.477 1.223-4.212 1.223H8.66l-.571 3.626H6.456l1.67-10.598h4.346c2.025 0 3.537.404 4.516 1.205.975.8 1.426 1.98 1.346 3.51.039.003.072.013.11.02.29.073.558.184.808.334.473.284.862.675 1.165 1.149z"})});else if("saleor.app.affirm"===e)return(0,o.jsxs)("svg",{width:"25",height:"25",viewBox:"0 0 175 129",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsxs)("g",{clipPath:"url(#clip0_2525_341)",children:[(0,o.jsx)("path",{d:"M28.5299 125.9C21.2699 114.84 17.0399 101.64 17.0399 87.4498C17.0399 48.6898 48.5699 17.1598 87.3299 17.1598C126.09 17.1598 157.62 48.6898 157.62 87.4498C157.62 101.63 153.38 114.84 146.13 125.9H165.81C171.52 114.29 174.74 101.24 174.74 87.4498C174.74 39.2498 135.53 0.0498047 87.3399 0.0498047C39.1499 0.0498047 -0.0600586 39.2598 -0.0600586 87.4498C-0.0600586 101.24 3.15994 114.29 8.86994 125.9H28.5299Z",fill:"#4A4AF4"}),(0,o.jsx)("path",{d:"M88.5098 45.9199C75.7098 45.9199 60.9798 51.9499 52.9798 58.3299L60.2798 73.6999C66.6898 67.8299 77.0598 62.8199 86.4098 62.8199C95.2998 62.8199 100.2 65.7899 100.2 71.7799C100.2 75.8099 96.9398 78.0799 90.7998 78.6399C67.7398 80.7599 49.8198 87.9599 49.8198 105.66C49.8198 119.7 59.9398 128.18 76.5898 128.18C87.7298 128.18 96.4798 121.99 101.2 113.82V125.89H121.96V75.2999C121.97 54.4099 107.44 45.9199 88.5098 45.9199ZM82.4498 111.96C75.7198 111.96 72.0298 109.08 72.0298 104.35C72.0298 94.4899 84.0798 92.1099 99.7698 92.1099C99.7698 102.43 92.8598 111.96 82.4498 111.96Z",fill:"black"})]}),(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:"clip0_2525_341",children:(0,o.jsx)("rect",{width:"174.82",height:"128.16",fill:"white"})})})]});return(0,o.jsx)("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"})})},Z=e=>e.toLowerCase().includes("authorize")?"Authorize.Net":e.toLowerCase().includes("stripe")?"Stripe":e.toLowerCase().includes("paypal")?"PayPal":e.toLowerCase().includes("affirm")?"Affirm":e;function $(e){var t,r,n,P;let{checkoutId:b,totalAmount:A,onSuccess:k,onError:B,onCheckoutBlocked:$,setIsProcessingPayment:K,availablePaymentGateways:J=[],kountConfig:Q,onStartPayment:W,selectedShippingId:X,userEmail:ee,guestEmail:et,lineItems:er=[],billingAddress:ea,shippingAddress:en,questionsValid:eo=!0,termsAccepted:ei=!0,termsData:es,onTermsModalOpen:el,onTermsAcceptedChange:ec,taxInfo:ed,disabled:eu=!1,onPaymentReady:ep}=e,em=J.filter(e=>!e.id.toLowerCase().includes("dummy")&&!e.name.toLowerCase().includes("dummy")),ey=(0,s.useRouter)(),{isLoggedIn:eh,user:ef}=(0,I.o)(),{recaptchaRef:eg,resetRecaptcha:ev}=(0,S.V)(),eC=(0,O.h)(),ex=eC.getGoogleTagManagerConfig(),{isLoaded:eP,isLoading:eb,loadAcceptJs:ew,error:eA}=function(){let[e,t]=(0,i.useState)(!1),[r,a]=(0,i.useState)(!1),[n,o]=(0,i.useState)(null);(0,i.useEffect)(()=>{void 0!==window.Accept&&t(!0)},[]);let s=(0,i.useCallback)(async()=>{if(void 0!==window.Accept)return void t(!0);if(r)return;let e=document.querySelector('script[src="'.concat(Y,'"]'));return e?new Promise((r,a)=>{e.addEventListener("load",()=>{t(!0),r()}),e.addEventListener("error",()=>{let e=Error("Failed to load Accept.js");o(e),a(e)})}):(a(!0),o(null),new Promise((e,r)=>{let n=document.createElement("script");n.src=Y,n.async=!0,n.onload=()=>{t(!0),a(!1),e()},n.onerror=()=>{let e=Error("Failed to load Authorize.Net Accept.js");o(e),a(!1),r(e)},document.head.appendChild(n)}))},[r]);return{isLoaded:e,isLoading:r,error:n,loadAcceptJs:s}}();(0,i.useEffect)(()=>{ew()},[ew]);let[eN,ek]=(0,i.useState)({cardNumber:"",expirationDate:"",cardCode:"",fullName:""}),[eE,ej]=(0,i.useState)((null==(t=em.find(e=>"mirumee.payments.authorize_net"===e.id))?void 0:t.id)||(null==(r=em[0])?void 0:r.id)||"mirumee.payments.authorize_net"),[eI,eS]=(0,i.useState)({}),[eM,eD]=(0,i.useState)(!1),[eL,eR]=(0,i.useState)(null),[eO,eT]=(0,i.useState)(!1),[e_,eV]=(0,i.useState)(null),[eH,eF]=(0,i.useState)(null),[eU,ez]=(0,i.useState)(!1),[eY,eB]=(0,i.useState)(!1),[eG,eq]=(0,i.useState)(!1);(0,i.useEffect)(()=>{eB(!1),eq(!1)},[b]),(0,i.useEffect)(()=>{((null==ef?void 0:ef.email)||ee||et)&&(eq(!1),eV(null),eF(null))},[null==ef?void 0:ef.email,ee,et]);let[eZ]=(0,l.n)(w),[e$]=(0,l.n)(N),[eK]=(0,l.n)(E),[eJ]=(0,l.n)(G),[eQ]=(0,l.n)(z.F),[eW]=function(e,t){if(!1!==globalThis.__DEV__){var r,n=t||{};(0,y.h)(n,"canonizeResults","useLazyQuery"),(0,y.h)(n,"variables","useLazyQuery","Pass all `variables` to the returned `execute` function instead."),(0,y.h)(n,"context","useLazyQuery","Pass `context` to the returned `execute` function instead."),(0,y.h)(n,"onCompleted","useLazyQuery","If your `onCompleted` callback sets local state, switch to use derived state using `data` returned from the hook instead. Use `useEffect` to perform side-effects as a result of updates to `data`."),(0,y.h)(n,"onError","useLazyQuery","If your `onError` callback sets local state, switch to use derived state using `data`, `error` or `errors` returned from the hook instead. Use `useEffect` if you need to perform side-effects as a result of updates to `data`, `error` or `errors`."),(0,y.h)(n,"defaultOptions","useLazyQuery","Pass the options directly to the hook instead."),(0,y.h)(n,"initialFetchPolicy","useLazyQuery","Use the `fetchPolicy` option instead."),(0,y.h)(n,"partialRefetch","useLazyQuery")}var o=d.useRef(void 0),i=d.useRef(void 0),s=d.useRef(void 0),l=(0,u.l)(t,o.current||{}),P=null!=(r=null==l?void 0:l.query)?r:e;i.current=t,s.current=P;var b=(0,c.Cl)((0,c.Cl)({},l),{skip:!o.current}),w=(0,p.SX)(P,b),A=w.obsQueryFields,N=w.result,k=w.client,E=w.resultData,j=w.observable,I=w.onQueryExecuted,S=j.options.initialFetchPolicy||(0,p.kk)(b.defaultOptions,k.defaultOptions),M=d.useReducer(function(e){return e+1},0)[1],D=d.useMemo(function(){for(var e={},t=function(t){var r=A[t];e[t]=function(){return!1!==globalThis.__DEV__&&"reobserve"===t&&!1!==globalThis.__DEV__&&h.V1.warn(80),o.current||(o.current=Object.create(null),M()),r.apply(this,arguments)}},r=0;r<v.length;r++)t(v[r]);return e},[M,A]),L=!!o.current,R=d.useMemo(function(){return(0,c.Cl)((0,c.Cl)((0,c.Cl)({},N),D),{called:L})},[N,D,L]),O=(a||(a=d.createContext(null)),d.useCallback(function(){var e=console.error;try{return console.error=g,d.useContext(a),!0}catch(e){return!1}finally{console.error=e}},[])),T=d.useRef(new Set),_=d.useCallback(function(e){if(!1!==globalThis.__DEV__){O()&&!1!==globalThis.__DEV__&&h.V1.warn(81);for(var t,r,a,n,l,d,m,y,g,v=0;v<C.length;v++){var b=C[v];T.current.has(b)||((0,f.cc)(e||{},b,"useLazyQuery.execute"),T.current.add(b))}for(var w=0;w<x.length;w++){var A=x[w];T.current.has(A)||((0,f.cc)(e||{},A,"useLazyQuery.execute","Please pass the option to the `useLazyQuery` hook instead."),T.current.add(A))}}o.current=e?(0,c.Cl)((0,c.Cl)({},e),{fetchPolicy:e.fetchPolicy||S}):{fetchPolicy:S};var N=(0,u.l)(i.current,(0,c.Cl)({query:s.current},o.current)),M=(t=E,r=j,a=k,n=P,l=(0,c.Cl)((0,c.Cl)({},N),{skip:!1}),d=I,m=l.query||n,y=(0,p.Er)(a,m,l,!1)(r),g=r.reobserveAsConcast((0,p.t_)(r,a,l,y)),d(y),new Promise(function(e){var n;g.subscribe({next:function(e){n=e},error:function(){e((0,p.$X)(r.getCurrentResult(),t.previousData,r,a))},complete:function(){e((0,p.$X)(r.maskResult(n),t.previousData,r,a))}})})).then(function(e){return Object.assign(e,D)});return M.catch(function(){}),M},[O,k,P,D,S,j,E,I]),V=d.useRef(_);return(0,m.E)(function(){V.current=_}),[d.useCallback(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return V.current.apply(V,e)},[]),R]}(j.rt),eX=(0,i.useCallback)(()=>{let e={};return eN.cardNumber.replace(/\s/g,"")?/^[\d\s]{13,19}$/.test(eN.cardNumber.replace(/\s/g,""))||(e.cardNumber="Please enter a valid card number"):e.cardNumber="Card number is required",eN.expirationDate?/^(0[1-9]|1[0-2])\/\d{2}$/.test(eN.expirationDate)||(e.expirationDate="Please enter a valid expiration date (MM/YY)"):e.expirationDate="Expiration date is required",eN.cardCode?/^\d{3,4}$/.test(eN.cardCode)||(e.cardCode="Please enter a valid security code"):e.cardCode="Security code is required",eN.fullName.trim()||(e.fullName="Cardholder name is required"),eC.isRecaptchaEnabledFor("checkout")&&!eL&&(e.recaptcha="Please complete the reCAPTCHA verification"),eS(e),0===Object.keys(e).length},[eN,eL,eC]),e0=(0,i.useCallback)((e,t)=>{let r=t;if("cardNumber"===e)r=(e=>{let t=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),r=t.match(/\d{4,16}/g),a=r&&r[0]||"",n=[];for(let e=0,t=a.length;e<t;e+=4)n.push(a.substring(e,e+4));return n.length?n.join(" "):t})(t);else if("expirationDate"===e)r=(e=>{let t=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return t.length>=2?t.substring(0,2)+"/"+t.substring(2,4):t})(t);else if("cardCode"===e&&(r=t.replace(/[^0-9]/g,"")).length>4)return;ek(t=>({...t,[e]:r})),eI[e]&&eS(t=>{let r={...t};return delete r[e],r})},[eI]),e1=(0,i.useCallback)(async()=>{if(eG)return e_;if(!(null==Q?void 0:Q.appConfiguration)||!er.length)return;let{activePaymentMethods:e,ipExclusions:t}=Q.appConfiguration;if(!e.some(e=>e.toLowerCase()===eE.toLowerCase()))return;let r=null;try{var a;eT(!0);let e=await H();if(t&&Array.isArray(t)&&t.includes(e))return eq(!0),null;let n=(null==ef?void 0:ef.email)||ee||et;if(!n)return null;let o=(null==ef?void 0:ef.id)||n||"guest-".concat(b),i=new Date().toISOString(),s=function(e,t){let r="";e?r=e.replace(/[^a-zA-Z0-9\-_]/g,"").substring(0,16):t&&(r=t.replace(/[^a-zA-Z0-9\-_]/g,"").substring(0,16));let a=Array.from(crypto.getRandomValues(new Uint8Array(8))).map(e=>e.toString(16).padStart(2,"0")).join("");return(r?"".concat(r,"-").concat(a):"device-".concat(a)).substring(0,36)}(null==ef?void 0:ef.id,b),l={merchantOrderId:b,deviceSessionId:s,userIp:e,account:{id:o,type:"REGISTERED",creationDateTime:new Date(i).toISOString(),username:n,accountIsActive:!0},items:er.map(e=>({id:e.id,price:Math.round(100*e.price),description:e.name,name:e.name,quantity:e.quantity,category:e.category||"Products",subCategory:"",isDigital:!1,sku:e.sku||""})),fulfillment:[{merchantFulfillmentId:b,type:"LOCAL_DELIVERY",status:"UNFULFILLED",items:er.map(e=>({id:e.id,quantity:e.quantity})),shipping:{amount:0,provider:"Standard",method:"STANDARD"},recipientPerson:{name:{first:(null==en?void 0:en.firstName)||"Guest",family:(null==en?void 0:en.lastName)||"User"},emailAddress:n,phoneNumber:(null==en?void 0:en.phone)||"+15551234567",address:{line1:(null==en?void 0:en.address)||"123 Main St",city:(null==en?void 0:en.city)||"Unknown",region:(null==en?void 0:en.state)||"Unknown",postalCode:(null==en?void 0:en.zipCode)||"00000",countryCode:(null==en?void 0:en.country)||"US"}}}],transactions:[{merchantTransactionId:F(),subtotal:Math.round(100*A),orderTotal:Math.round(100*A),currency:"USD",transactionStatus:"PENDING",billedPerson:{name:{first:(null==ea?void 0:ea.firstName)||(null==en?void 0:en.firstName)||"Guest",family:(null==ea?void 0:ea.lastName)||(null==en?void 0:en.lastName)||"User"},emailAddress:n,phoneNumber:(null==ea?void 0:ea.phone)||(null==en?void 0:en.phone)||"+15551234567",address:{line1:(null==ea?void 0:ea.address)||(null==en?void 0:en.address)||"123 Main St",city:(null==ea?void 0:ea.city)||(null==en?void 0:en.city)||"Unknown",region:(null==ea?void 0:ea.state)||(null==en?void 0:en.state)||"Unknown",postalCode:(null==ea?void 0:ea.zipCode)||(null==en?void 0:en.zipCode)||"00000",countryCode:(null==ea?void 0:ea.country)||(null==en?void 0:en.country)||"US"}},items:er.map(e=>({id:e.id,quantity:e.quantity})),tax:{isTaxable:((null==ed?void 0:ed.totalTax)||0)>0,taxableCountryCode:(null==ea?void 0:ea.country)||(null==en?void 0:en.country)||"US",taxAmount:Math.round(100*((null==ed?void 0:ed.totalTax)||0))}}]},c=await T.u.performFraudCheck(l);r={kountOrderId:c.order.orderId,transactionId:(null==(a=c.order.transactions[0])?void 0:a.transactionId)||F()},eV(r),eF(r),eq(!0);let d=c.order.riskInquiry,u=d.persona,p=[{key:"kount_decision",value:d.decision},{key:"omniscore",value:d.omniscore.toString()},{key:"uniqueCards",value:u.uniqueCards.toString()},{key:"uniqueDevices",value:u.uniqueDevices.toString()},{key:"uniqueEmails",value:u.uniqueEmails.toString()},{key:"riskiestCountry",value:u.riskiestCountry},{key:"totalBankApprovedOrders",value:u.totalBankApprovedOrders.toString()},{key:"totalBankDeclinedOrders",value:u.totalBankDeclinedOrders.toString()},{key:"maxVelocity",value:u.maxVelocity.toString()},{key:"riskiestRegion",value:u.riskiestRegion}];await eQ({variables:{id:b,input:p}}).catch(e=>{var t;if(null==(t=e.message)?void 0:t.includes("Couldn't resolve to a node"))throw Error("Your checkout session has expired during fraud check. Please refresh the page and try again.");throw e});let{blockCheckout:m,blockedCheckoutMessage:y}=Q.appConfiguration,h=d.decision;if("DECLINE"===h&&m){let e=y||"Your order cannot be processed due to security concerns. Please contact support for assistance.";$&&$(e);let t=Error(e);throw t.isKountBlocking=!0,t}}catch(e){if(e instanceof Error&&e.isKountBlocking)throw e;if(e instanceof Error&&e.message.includes("Couldn't resolve to a node"))throw Error("Your checkout session has expired. Please refresh the page and try again.")}finally{eT(!1)}return r},[Q,eE,er,ef,ee,et,b,A,en,ea,eQ,$,eG,eq,e_]),e2=(0,i.useCallback)(async(e,t,r,a)=>{let n=a||e_||eH;if(n)try{let a=r.replace(/\s/g,"").substring(0,6),o=function(e,t){if(t){let e=t.toLowerCase();if(e.includes("paypal"))return U.PAYPAL;if(e.includes("apple")||e.includes("applepay"))return U.APPLE_PAY;if(e.includes("google")||e.includes("googlepay"))return U.GOOGLE_CHECKOUT;if(e.includes("samsung")||e.includes("samsungpay"))return U.SAMSUNG_PAY;if(e.includes("amazon"))return U.AMAZON_PAY;if(e.includes("affirm"))return U.AFFIRM;if(e.includes("afterpay"))return U.AFTERPAY;if(e.includes("klarna"))return U.KLARNA;if(e.includes("alipay"))return U.ALIPAY;if(e.includes("wechat"))return U.WECHAT_PAY;if(e.includes("facebook"))return U.FACEBOOK_PAY;if(e.includes("sofort"))return U.SOFORT;if(e.includes("giropay"))return U.GIROPAY;if(e.includes("sepa"))return U.SEPA;if(e.includes("interac"))return U.INTERAC;if(e.includes("splitit"))return U.SPLITIT;if(e.includes("crypto")||e.includes("bitcoin")||e.includes("ethereum"))return U.CRYPTO}let r=e.replace(/\D/g,"");if(!r||r.length<4)return U.CREDIT_CARD;let a=r.charAt(0),n=r.substring(0,2),o=r.substring(0,3),i=r.substring(0,4);if("4"===a)return U.CREDIT_CARD;if("5"===a){let e=parseInt(r.charAt(1));if(e>=1&&e<=5)return U.CREDIT_CARD}if("2"===a){let e=parseInt(i);if(e>=2221&&e<=2720)return U.CREDIT_CARD}if("34"===n||"37"===n||"6011"===i||"65"===n)return U.CREDIT_CARD;if("64"===n){let e=parseInt(r.charAt(2));if(e>=4&&e<=9)return U.CREDIT_CARD}if("622"===o){let e=parseInt(r.substring(3,6));if(e>=126&&e<=925)return U.CREDIT_CARD}return o>="300"&&o<="305"||"36"===n||"38"===n||"35"===n||"2131"===i||"1800"===i||"62"===n?U.CREDIT_CARD:["5018","5020","5038","5893","6304","6759","6761","6762","6763"].includes(i)?U.DEBIT_CARD:U.CREDIT_CARD}(r,eE),i={kountOrderId:n.kountOrderId,transactions:[{transactionId:n.transactionId,paymentStatus:e?"AUTHORIZED":"REFUSED",authorizationStatus:{authResult:e?"Approved":"Declined",verificationResponse:{cvvStatus:"Match",avsStatus:"Y"}},payment:{type:o,paymentToken:t,bin:a}}]};await T.u.updateKountOrder(i)}catch(e){}},[e_,eH]),e3=(0,i.useCallback)(async()=>{var e,t,r,a,n,o,i,s,l,c,d,u,p,m,y,h;if(eU||!eX())return;try{let r=await eW({variables:{id:b}});if(!(null==(e=r.data)?void 0:e.checkout))return void B("Your checkout session has expired. Please refresh the page and try again.");let a=r.data.checkout;eh&&(null==ef?void 0:ef.id)&&(null==(t=a.user)?void 0:t.id)===ef.id&&eB(!0)}catch(e){e instanceof Error&&e.message.includes("Couldn't resolve to a node")?B("Your checkout session has expired. Please refresh the page and try again."):B("Unable to validate checkout. Please refresh the page and try again.");return}if(eC.isRecaptchaEnabledFor("checkout")&&!eL)return void B("Please complete the reCAPTCHA verification before proceeding with payment.");ez(!0);let f=null;try{f=await e1()||null,eD(!0),K({isModalOpen:!0,paymentProcessingLoading:!0,error:!1,success:!1})}catch(e){if(e instanceof Error&&e.isKountBlocking){eD(!1),ez(!1),K({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!1});return}}let g="";try{let e;if(W&&await W(),X)try{let e={selectedShippingId:X,timestamp:Date.now()};localStorage.setItem("pendingPaymentData",JSON.stringify(e))}catch(e){}if(eh&&(null==ef?void 0:ef.email)&&(null==ef?void 0:ef.id)&&!eY)try{await eK({variables:{checkoutId:b,customerId:ef.id}}).catch(e=>{var t,r;if(null==(t=e.message)?void 0:t.includes("Couldn't resolve to a node"))throw Error("Your checkout session has expired while attaching customer. Please refresh the page and try again.");if(null==(r=e.message)?void 0:r.includes("cannot reassign a checkout that is already attached"))return void eB(!0)}),eB(!0)}catch(e){if(e instanceof Error&&e.message.includes("checkout session has expired"))throw e;e instanceof Error&&e.message.includes("cannot reassign a checkout that is already attached")&&eB(!0)}if(X)try{let e=await eJ({variables:{id:b,deliveryMethodId:X}}).catch(e=>{var t;if(null==(t=e.message)?void 0:t.includes("Couldn't resolve to a node"))throw Error("Your checkout session has expired while setting delivery method. Please refresh the page and try again.");throw e});if(null==(d=e.data)||null==(c=d.checkoutDeliveryMethodUpdate)||null==(l=c.errors)?void 0:l.length){let t=e.data.checkoutDeliveryMethodUpdate.errors;K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Failed to set delivery method: ".concat(t[0].message));return}}catch(e){K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Failed to set delivery method. Please try again.");return}if(er.length>0){let e=er.map((e,t)=>({item_id:e.id,item_name:e.name,item_category:e.category||"Products",price:e.price,quantity:e.quantity,currency:"USD",index:t})),t=er.reduce((e,t)=>e+t.price*t.quantity,0),r=eE.includes("authorize_net")?"authorize_net":eE.includes("stripe")?"stripe":eE.includes("dummy")?"dummy":"other";(0,R.Ms)(e,"USD",t,void 0,r,null==ex?void 0:ex.container_id)}if(!(e=em.length>0?em.find(e=>e.id===eE):null==(m=(await eW({variables:{id:b}})).data)||null==(p=m.checkout)||null==(u=p.availablePaymentGateways)?void 0:u.find(e=>e.id===eE))){K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B('Selected payment gateway "'.concat(eE,'" is not available'));return}if("mirumee.payments.authorize_net"===eE){let t=e.config||[],r=null==(y=t.find(e=>"client_key"===e.field))?void 0:y.value,a=null==(h=t.find(e=>"api_login_id"===e.field))?void 0:h.value;if(!r||!a){K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Authorize.Net credentials not configured properly");return}g=await new Promise((e,t)=>{if(void 0===window.Accept)return void t(Error("Authorize.Net Accept.js not loaded. Please refresh the page and try again."));let n={cardData:{cardNumber:eN.cardNumber.replace(/\s/g,""),month:eN.expirationDate.split("/")[0],year:"20"+eN.expirationDate.split("/")[1],cardCode:eN.cardCode,fullName:eN.fullName},authData:{clientKey:r,apiLoginID:a}};window.Accept.dispatchData(n,r=>{var a,n,o;if("Error"===r.messages.resultCode){let e=(null==(n=r.messages.message)||null==(a=n[0])?void 0:a.text)||"Payment tokenization failed";t(Error(e))}else e((null==(o=r.opaqueData)?void 0:o.dataValue)||"")})})}else if("saleor.app.payment.stripe"===eE)g="stripe_payment_token_placeholder";else if(eE.includes("dummy"))g="dummy_payment_token";else{K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B('Payment gateway "'.concat(eE,'" is not supported yet'));return}let t=await e$({variables:{checkoutId:b,input:{gateway:eE,token:g,amount:A}}}).catch(e=>{var t;if(null==(t=e.message)?void 0:t.includes("Couldn't resolve to a node"))throw Error("Your checkout session has expired. Please refresh the page and try again.");throw e});if(null==(n=t.data)||null==(a=n.checkoutPaymentCreate)||null==(r=a.errors)?void 0:r.length){let e=t.data.checkoutPaymentCreate.errors;K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Payment creation failed: ".concat(e[0].message));return}if(!(null==(i=t.data)||null==(o=i.checkoutPaymentCreate)?void 0:o.payment)){K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Payment creation failed: No payment was created");return}let{order:v,errors:C}=(null==(s=(await eZ({variables:{checkoutId:b}}).catch(e=>{var t;if(null==(t=e.message)?void 0:t.includes("Couldn't resolve to a node"))throw Error("Your checkout session has expired during payment completion. Please refresh the page and try again.");throw e})).data)?void 0:s.checkoutComplete)||{};if(C&&C.length>0){let e=C.map(e=>e.message).join(", ");K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Checkout completion failed: ".concat(e));return}if(v){await e2(!0,g,eN.cardNumber,f),K({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!0});let e=v.id,t=v.number,r=v.total.gross.amount;ey.push("/order-confirmation?orderId=".concat(e,"&orderNumber=").concat(t,"&total=").concat(r)),k()}else K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),B("Payment completed but no order was created. Please contact support.")}catch(e){g&&await e2(!1,g,eN.cardNumber,f),K({isModalOpen:!1,paymentProcessingLoading:!1,error:!0,success:!1}),e instanceof Error?e.message.includes("Couldn't resolve to a node")||e.message.includes("checkout session has expired")?B("Your checkout session has expired. Please refresh the page and try again."):B("Payment failed: ".concat(e.message)):B("An unexpected error occurred during payment processing."),eR(null),ev()}finally{eD(!1),ez(!1)}},[eX,eN,b,A,W,eh,ef,eK,er,X,e$,eZ,ey,k,B,K,eJ,eW,eL,ev,eR,e1,$,e2,eU,eY,eB,eF,eG,eq]),e9=(0,i.useCallback)(async e=>{e.preventDefault(),await e3()},[e3]),e7=(0,i.useRef)(e3);if((0,i.useEffect)(()=>{e7.current=e3},[e3]),(0,i.useEffect)(()=>{ep&&ep(()=>e7.current())},[ep]),eM)return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)(L.A,{className:"h-32"}),(0,o.jsx)("p",{className:"text-center text-sm text-[var(--color-secondary-600)]",children:"Processing payment..."})]});let e5="saleor.app.payment.paypal"===eE,e8="saleor.app.affirm"===eE;return e5?(0,o.jsxs)("div",{className:"",children:[em.length>0&&(0,o.jsx)("div",{className:"bg-white border border-[var(--color-secondary-200)] p-4 ".concat(eu?"opacity-60 pointer-events-none":""),children:(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:em.map(e=>(0,o.jsxs)("label",{className:"flex items-center gap-3 ring-1 p-2 transition-all duration-200 ".concat(eu?"cursor-not-allowed opacity-50 pointer-events-none":"cursor-pointer"," ").concat(eE===e.id?"ring-[var(--color-primary-100)] bg-[var(--color-primary-50)] text-[var(--color-primary-700)] accent-[var(--color-primary-600)]":"ring-gray-300 hover:bg-gray-50"," ").concat(eu?"":"hover:bg-gray-50"),children:[(0,o.jsx)("input",{type:"radio",name:"paymentMethod",value:e.id,checked:eE===e.id,onChange:e=>ej(e.target.value),disabled:eu}),(0,o.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[q(e.id),(0,o.jsx)("span",{className:"font-medium text-base/none font-secondary",children:Z(e.name)})]})]},e.id))})}),(0,o.jsx)("div",{className:"bg-white border border-[var(--color-secondary-200)] p-4 ".concat(eu?"opacity-60 pointer-events-none":""),children:(0,o.jsx)(_,{checkoutId:b,totalAmount:A,currency:"USD",onSuccess:k,onError:B,setIsProcessingPayment:K,userEmail:ee,guestEmail:et,termsAccepted:ei,termsData:es,onTermsModalOpen:el,onTermsAcceptedChange:ec,questionsValid:eo})})]}):e8?(0,o.jsxs)("div",{className:"",children:[em.length>0&&(0,o.jsx)("div",{className:"bg-white border border-[var(--color-secondary-200)] p-4 ".concat(eu?"opacity-60 pointer-events-none":""),children:(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:em.map(e=>(0,o.jsxs)("label",{className:"flex items-center gap-3 ring-1 p-2 transition-all duration-200 ".concat(eE===e.id?"ring-[var(--color-primary-600)] bg-[var(--color-primary-50)]":"ring-[var(--color-secondary-200)] hover:ring-[var(--color-secondary-300)]"," cursor-pointer"),children:[(0,o.jsx)("input",{type:"radio",name:"paymentGateway",value:e.id,checked:eE===e.id,onChange:e=>ej(e.target.value),className:"sr-only"}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[q(e.id),(0,o.jsx)("span",{className:"text-sm font-medium text-[var(--color-secondary-800)]",children:Z(e.name)})]})]},e.id))})}),(0,o.jsx)("div",{className:"bg-white border border-[var(--color-secondary-200)] p-4 ".concat(eu?"opacity-60 pointer-events-none":""),children:(0,o.jsx)(V,{checkoutId:b,totalAmount:A,currency:"USD",onSuccess:k,onError:B,setIsProcessingPayment:K,userEmail:ee,guestEmail:et,termsAccepted:ei,termsData:es,onTermsModalOpen:el,onTermsAcceptedChange:ec,questionsValid:eo})})]}):(0,o.jsx)("div",{className:"space-y-6",children:(0,o.jsxs)("form",{onSubmit:e9,children:[em.length>0&&(0,o.jsx)("div",{className:"bg-white border border-[var(--color-secondary-200)] p-4 ".concat(eu?"opacity-60 pointer-events-none":""),children:(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:em.map(e=>(0,o.jsxs)("label",{className:"flex items-center gap-3 ring-1 p-2 transition-all duration-200 ".concat(eu?"cursor-not-allowed opacity-50 pointer-events-none":"cursor-pointer"," ").concat(eE===e.id?"ring-[var(--color-primary-100)] bg-[var(--color-primary-50)] text-[var(--color-primary-700)] accent-[var(--color-primary-600)]":"ring-gray-300 hover:bg-gray-50"," ").concat(eu?"":"hover:bg-gray-50"),children:[(0,o.jsx)("input",{type:"radio",name:"paymentMethod",value:e.id,checked:eE===e.id,onChange:e=>ej(e.target.value),disabled:eu}),(0,o.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[q(e.id),(0,o.jsx)("span",{className:"font-medium text-base/none font-secondary",children:Z(e.name)})]})]},e.id))})}),(0,o.jsx)("div",{className:"bg-white border border-[var(--color-secondary-200)] p-4 ".concat(eu?"opacity-60 pointer-events-none":""),children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(D.A,{name:"fullName",label:"Cardholder Name",htmlFor:"fullName",type:"text",id:"fullName",value:eN.fullName,onChange:e=>e0("fullName",e.target.value),className:"w-full ".concat(eI.fullName?"border-red-300 focus:ring-red-500":"border-[var(--color-secondary-300)]"," py-2"),placeholder:"John Doe",disabled:eu}),eI.fullName&&(0,o.jsx)("p",{className:"text-red-500 text-xs mt-1",children:eI.fullName})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(D.A,{name:"cardNumber",label:"Card Number",htmlFor:"cardNumber",type:"text",id:"cardNumber",value:eN.cardNumber,onChange:e=>e0("cardNumber",e.target.value),className:"w-full ".concat(eI.cardNumber?"border-red-300 focus:ring-red-500":"border-[var(--color-secondary-300)]"," py-2"),placeholder:"1234 5678 9012 3456",maxLength:19,disabled:eu}),eI.cardNumber&&(0,o.jsx)("p",{className:"text-red-500 text-xs mt-1",children:eI.cardNumber})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(D.A,{name:"expirationDate",label:"Expiration Date",htmlFor:"expirationDate",type:"text",id:"expirationDate",value:eN.expirationDate,onChange:e=>e0("expirationDate",e.target.value),className:"w-full ".concat(eI.expirationDate?"border-red-300 focus:ring-red-500":"border-[var(--color-secondary-300)]"," py-2"),placeholder:"MM/YY",maxLength:5,disabled:eu}),eI.expirationDate&&(0,o.jsx)("p",{className:"text-red-500 text-xs mt-1",children:eI.expirationDate})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(D.A,{name:"cardCode",label:"Security Code",htmlFor:"cardCode",type:"text",id:"cardCode",value:eN.cardCode,onChange:e=>e0("cardCode",e.target.value),className:"w-full ".concat(eI.cardCode?"border-red-300 focus:ring-red-500":"border-[var(--color-secondary-300)]"," py-2"),placeholder:"123",maxLength:4,disabled:eu}),eI.cardCode&&(0,o.jsx)("p",{className:"text-red-500 text-xs mt-1",children:eI.cardCode})]})]})]})}),eC.isRecaptchaEnabledFor("checkout")&&(0,o.jsxs)("div",{className:"flex flex-col items-start py-4",children:[(0,o.jsx)(M.A,{ref:eg,sitekey:(null==(n=eC.getGoogleRecaptchaConfig())?void 0:n.site_key)||"",theme:"light",size:"normal",onChange:e=>{eR(e),e&&eI.recaptcha&&eS(e=>{let t={...e};return delete t.recaptcha,t})},onExpired:()=>{eR(null),ev()},onError:()=>{eR(null),ev()}}),eI.recaptcha&&(0,o.jsx)("p",{className:"text-red-500 text-xs mt-2 text-center",children:eI.recaptcha})]}),eC.isRecaptchaEnabledFor("checkout")&&(0,o.jsxs)("div",{className:"text-xs text-[var(--color-secondary-600)] text-center py-2",children:["This site is protected by reCAPTCHA and the Google"," ",(0,o.jsx)("a",{href:"https://policies.google.com/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Privacy Policy"})," ","and"," ",(0,o.jsx)("a",{href:"https://policies.google.com/terms",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Terms of Service"})," ","apply."]}),(null==es||null==(P=es.page)?void 0:P.isPublished)&&(0,o.jsxs)("div",{className:"flex items-start gap-2 w-full py-2",children:[(0,o.jsx)("input",{style:{accentColor:"var(--color-primary-600)"},type:"checkbox",id:"termsAcceptedPayment",className:"w-5 h-5 cursor-pointer mt-0.5",checked:ei,onChange:e=>null==ec?void 0:ec(e.target.checked)}),(0,o.jsxs)("label",{htmlFor:"termsAcceptedPayment",style:{color:"var(--color-secondary-600)"},className:"text-sm lg:text-base tracking-[-0.04px] cursor-pointer",children:["I agree to the"," ",(0,o.jsx)("button",{type:"button",onClick:el,className:"font-semibold text-[var(--color-primary-600)] hover:underline focus:underline focus:outline-none",children:"Terms and Conditions"})]})]})]})})}}}]);