"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3533],{6678:(e,r,t)=>{t.d(r,{V:()=>a});var s=t(7620);let a=()=>{let e=(0,s.useRef)(null),r=(0,s.useCallback)(async()=>{if(!e.current)return console.warn("reCAPTCHA ref not available"),null;try{return await e.current.executeAsync()}catch(e){return console.error("reCAPTCHA execution failed:",e),null}},[]),t=(0,s.useCallback)(()=>{e.current&&e.current.reset()},[]);return{recaptchaRef:e,getRecaptchaToken:r,resetRecaptcha:t}}},18752:(e,r,t)=>{t.d(r,{F:()=>i});var s=t(46590);function a(){let e=(0,s._)(["\n  mutation UpdateCheckoutMetadata($id: ID!, $input: [MetadataInput!]!) {\n    updateMetadata(id: $id, input: $input) {\n      item {\n        ... on Checkout {\n          id\n          token\n          metadata {\n            key\n            value\n          }\n        }\n      }\n      errors {\n        field\n        message\n      }\n    }\n  }\n"]);return a=function(){return e},e}let i=(0,t(26177).J1)(a())},53533:(e,r,t)=>{t.r(r),t.d(r,{default:()=>x});var s=t(54568),a=t(7620),i=t(2244),l=t(6678),n=t(70498),o=t(78604),c=t(46590);function u(){let e=(0,c._)(['\n  query GetCheckoutQuestions {\n    page(slug: "checkout-question") {\n      id\n      title\n      slug\n      content\n      seoTitle\n      seoDescription\n      isPublished\n      metadata {\n        key\n        value\n      }\n    }\n  }\n']);return u=function(){return e},e}let d=(0,t(26177).J1)(u());var h=t(18752),m=t(21447);function p(e){let{question:r,value:t,onChange:a,error:i}=e,l="question-".concat(r.id),n="".concat(l,"-error"),o="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-[var(--color-primary-500)] focus:border-[var(--color-primary-500)] transition-colors ".concat(i?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 hover:border-gray-400");return"text"===r.type?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:l,className:"block text-sm font-medium text-gray-700",children:[r.question,r.required&&(0,s.jsx)("span",{className:"text-red-500 ml-1","aria-hidden":"true",children:"*"}),r.required&&(0,s.jsx)("span",{className:"sr-only",children:" (required)"})]}),(0,s.jsx)("textarea",{id:l,value:t,onChange:e=>a(e.target.value),className:"".concat(o," min-h-[80px] outline-none resize-vertical"),placeholder:"Enter your answer".concat(r.required?" (required)":""),required:r.required,"aria-required":r.required,"aria-invalid":i?"true":void 0,"aria-describedby":i?n:void 0}),i&&(0,s.jsx)("p",{id:n,className:"text-sm text-red-600",role:"alert",children:i})]}):"select"===r.type&&r.options?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:l,className:"block text-sm font-medium text-gray-700",children:[r.question,r.required&&(0,s.jsx)("span",{className:"text-red-500 ml-1","aria-hidden":"true",children:"*"}),r.required&&(0,s.jsx)("span",{className:"sr-only",children:" (required)"})]}),(0,s.jsxs)("select",{id:l,value:t,onChange:e=>a(e.target.value),className:o,required:r.required,"aria-required":r.required,"aria-invalid":i?"true":void 0,"aria-describedby":i?n:void 0,children:[(0,s.jsxs)("option",{value:"",children:["Please select an option",r.required?" (required)":""]}),r.options.map((e,r)=>(0,s.jsx)("option",{value:e,children:e},r))]}),i&&(0,s.jsx)("p",{id:n,className:"text-sm text-red-600",role:"alert",children:i})]}):"radio"===r.type&&r.options?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("fieldset",{"aria-invalid":i?"true":void 0,"aria-describedby":i?n:void 0,children:[(0,s.jsxs)("legend",{className:"block text-sm font-medium text-gray-700",children:[r.question,r.required&&(0,s.jsx)("span",{className:"text-red-500 ml-1","aria-hidden":"true",children:"*"}),r.required&&(0,s.jsx)("span",{className:"sr-only",children:" (required)"})]}),(0,s.jsx)("div",{className:"mt-2 space-y-2",role:"radiogroup","aria-required":r.required,children:r.options.map((e,i)=>(0,s.jsxs)("label",{className:"flex items-center gap-3 ring-1 p-3 cursor-pointer rounded transition-colors ".concat(t===e?"ring-[var(--color-primary-100)] bg-[var(--color-primary-50)] text-[var(--color-primary-700)]":"ring-gray-300 hover:bg-gray-50"),children:[(0,s.jsx)("input",{type:"radio",name:l,value:e,checked:t===e,onChange:e=>a(e.target.value),className:"h-4 w-4 text-[var(--color-primary-600)] border-gray-300 focus:ring-[var(--color-primary-500)] accent-[var(--color-primary-600)]",required:r.required}),(0,s.jsx)("span",{className:"text-sm flex-1",children:e})]},i))})]}),i&&(0,s.jsx)("p",{id:n,className:"text-sm text-red-600 mt-2",role:"alert",children:i})]}):null}function x(e){var r;let{isLoggedIn:t,grandTotal:c,checkoutId:u,onQuestionsChange:x,onValidationChange:v,onSaveQuestions:f}=e,{data:y,loading:g,error:q}=(0,i.IT)(d,{fetchPolicy:"cache-first"}),[b,C]=(0,a.useState)({}),[j,N]=(0,a.useState)({}),[k,A]=(0,a.useState)(!1),[w,P]=(0,a.useState)(null),{recaptchaRef:E,getRecaptchaToken:T,resetRecaptcha:H}=(0,l.V)(),Q=(0,o.h)(),R=(0,a.useRef)(v),[_]=(0,m.n)(h.F);(0,a.useEffect)(()=>{R.current=v});let F=(0,a.useMemo)(()=>y?function(e){if(!(null==e?void 0:e.page)||!e.page.isPublished)return null;let r=e.page.metadata,t=[],s=!1,a=null,i=!1;return r.forEach(e=>{let{key:r,value:l}=e;if("guest_only"===r)s="true"===l;else if("order_value"===r){let e=parseFloat(l);a=isNaN(e)?null:e}else if("reCAPTCHA"===r)i="true"===l;else if(r.startsWith("question-")){let e=l.split(":");if(e.length>=2){let s,a=e[0].trim(),i=e[1].trim();e.length>2&&e[2].trim()&&(s=e[2].split(",").map(e=>e.trim()).filter(e=>e.length>0)),i&&t.push({id:r,required:"r"===a,question:i,options:s,type:s&&s.length>0?s.length<=4?"radio":"select":"text"})}}}),{isPublished:e.page.isPublished,guestOnly:s,orderValueThreshold:a,showReCAPTCHA:i,questions:t.sort((e,r)=>e.id.localeCompare(r.id))}}(y):null,[y]),S=(0,a.useCallback)(async()=>{if(!u||!(null==F?void 0:F.questions.length))return void console.log("[CheckoutQuestions] No checkout ID or questions to save");let e=[];if(F.questions.forEach((r,t)=>{var s;let a=t+1,i=(null==(s=b[r.id])?void 0:s.trim())||"";e.push({key:"question-".concat(a),value:r.question},{key:"answer-".concat(a),value:i})}),0===e.length)return void console.log("[CheckoutQuestions] No answers to save");try{var r,t,s;let a=await _({variables:{id:u,input:e}});if(null==(s=a.data)||null==(t=s.updateMetadata)||null==(r=t.errors)?void 0:r.length){let e=a.data.updateMetadata.errors[0].message;throw console.error("[CheckoutQuestions] Error saving questions:",e),Error("Failed to save questions: ".concat(e))}console.log("[CheckoutQuestions] Questions saved successfully")}catch(e){throw console.error("[CheckoutQuestions] Error saving questions:",e),e}},[u,F,b,_]);(0,a.useEffect)(()=>{f&&f(S)},[f,S]);let M=(0,a.useCallback)(()=>!!(null==F?void 0:F.isPublished)&&(!F.guestOnly||!t)&&(!F.orderValueThreshold||!(c<F.orderValueThreshold)),[F,t,c]),D=(0,a.useCallback)(()=>{if(!F)return!0;let e={},r=!1;return F.questions.forEach(t=>{var s;let a=(null==(s=b[t.id])?void 0:s.trim())||"";t.required&&!a&&(e[t.id]="This field is required",r=!0)}),F.showReCAPTCHA&&!w&&(e.recaptcha="Please complete the reCAPTCHA verification",r=!0),!r},[F,b,w]),I=(0,a.useCallback)((e,r)=>{C(t=>({...t,[e]:r})),N(r=>{if(r[e]){let t={...r};return delete t[e],t}return r})},[]);(0,a.useEffect)(()=>{x&&x(b)},[b,x]);let J=async e=>{if(e.preventDefault(),D()){A(!0);try{if((null==F?void 0:F.showReCAPTCHA)&&!await T())throw H(),Error("reCAPTCHA verification failed. Please try again.");console.log("Checkout questions answers:",b),(null==F?void 0:F.showReCAPTCHA)&&H()}catch(e){console.error("Failed to submit checkout questions:",e),(null==F?void 0:F.showReCAPTCHA)&&H()}finally{A(!1)}}};return((0,a.useEffect)(()=>{var e,r;if(!F||0===F.questions.length){null==(r=R.current)||r.call(R,!0);return}let t={},s=!1;F.questions.forEach(e=>{var r;let a=(null==(r=b[e.id])?void 0:r.trim())||"";e.required&&!a&&(t[e.id]="This field is required",s=!0)}),F.showReCAPTCHA&&!w&&(t.recaptcha="Please complete the reCAPTCHA verification",s=!0),N(e=>JSON.stringify(e)!==JSON.stringify(t)?t:e);let a=!s;null==(e=R.current)||e.call(R,a)},[b,F,w]),(0,a.useEffect)(()=>{if(!M()||!F){var e;null==(e=R.current)||e.call(R,!0)}},[F,M]),g)?(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold font-secondary text-[var(--color-secondary-800)] mb-3 uppercase",children:"Questions"}),(0,s.jsx)("p",{className:"text-sm text-[var(--color-secondary-600)]",children:"Loading questions..."})]})}):M()&&F?q?(console.warn("Failed to load checkout questions:",q),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold font-secondary text-[var(--color-secondary-800)] mb-3 uppercase",children:"Questions"}),(0,s.jsx)("div",{className:"text-sm text-red-600 bg-red-50 border border-red-200 rounded p-3",children:(0,s.jsxs)("p",{children:["Error loading questions: ",q.message]})})]})})):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold font-secondary text-gray-800 mb-3 md:mb-5 uppercase",children:"Questions"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Please answer the following questions to help us improve your experience."})]}),(0,s.jsxs)("form",{onSubmit:J,className:"space-y-6",children:[F.questions.map(e=>(0,s.jsx)(p,{question:e,value:b[e.id]||"",onChange:r=>I(e.id,r),error:j[e.id]},e.id)),F.showReCAPTCHA&&(0,s.jsxs)("div",{className:"flex flex-col items-start py-4",children:[(0,s.jsx)(n.A,{ref:E,sitekey:(null==(r=Q.getGoogleRecaptchaConfig())?void 0:r.site_key)||"",theme:"light",size:"normal",onChange:e=>{P(e),e&&j.recaptcha&&N(e=>{let r={...e};return delete r.recaptcha,r})},onExpired:()=>{P(null),H()},onError:()=>{P(null),H()}}),j.recaptcha&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-2 text-center",children:j.recaptcha})]})]})]}):null}}}]);