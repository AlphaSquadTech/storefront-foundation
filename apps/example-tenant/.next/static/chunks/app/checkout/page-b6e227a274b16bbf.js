(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8279],{2890:(e,t,n)=>{Promise.resolve().then(n.bind(n,65456))},35773:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var r=n(24338);let a="https://kount.wsm-dev.com/api";async function s(e,t){let n,r="".concat(a).concat(e);try{n=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",...t},cache:"no-store"})}catch(e){throw Error("GET ".concat(r," network error: ").concat(e instanceof Error?e.message:String(e)))}if(!n.ok){let e=n.statusText;try{let t=await n.json();e=(null==t?void 0:t.message)||e}catch(e){}throw Error("GET ".concat(r," failed: ").concat(n.status," ").concat(e))}return n.json()}async function o(e,t,n){let r,s="".concat(a).concat(e);try{r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...n},body:JSON.stringify(t),cache:"no-store"})}catch(e){throw Error("POST ".concat(s," network error: ").concat(e instanceof Error?e.message:String(e)))}if(!r.ok){let e=r.statusText;try{let t=await r.json();e=(null==t?void 0:t.message)||e}catch(e){}throw Error("POST ".concat(s," failed: ").concat(r.status," ").concat(e))}return r.json()}async function l(e,t,n){let r,s="".concat(a).concat(e);try{r=await fetch(s,{method:"PATCH",headers:{"Content-Type":"application/json",...n},body:JSON.stringify(t),cache:"no-store"})}catch(e){throw Error("PATCH ".concat(s," network error: ").concat(e instanceof Error?e.message:String(e)))}if(!r.ok){let e=r.statusText;try{let t=await r.json();e=(null==t?void 0:t.message)||e}catch(e){}throw Error("PATCH ".concat(s," failed: ").concat(r.status," ").concat(e))}return r.json()}let i={async getKountConfig(){let e=r.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("NEXT_PUBLIC_API_URL is not configured");return s("/get-kount-config",{"Saleor-Domain":e})},async performFraudCheck(e){let t=r.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("NEXT_PUBLIC_API_URL is not configured");return o("/kount-fraud-check",e,{"Saleor-Domain":t})},async updateKountOrder(e){let t=r.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("NEXT_PUBLIC_API_URL is not configured");return l("/kount-order-update",e,{"Saleor-Domain":t})}}},59382:(e,t,n)=>{"use strict";n.d(t,{J:()=>s});var r=n(46590);function a(){let e=(0,r._)(["\n  query CheckoutTermsAndConditions($slug: String!) {\n    page(slug: $slug) {\n      id\n      title\n      slug\n      content\n      seoTitle\n      seoDescription\n      isPublished\n      metadata {\n        key\n        value\n      }\n    }\n  }\n"]);return a=function(){return e},e}let s=(0,n(26177).J1)(a())},62942:(e,t,n)=>{"use strict";var r=n(42418);n.o(r,"notFound")&&n.d(t,{notFound:function(){return r.notFound}}),n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},65456:(e,t,n)=>{"use strict";n.d(t,{default:()=>H});var r=n(54568),a=n(91039),s=n(62942),o=n(78136),l=n(75188),i=n(87509);let c=[{text:"HOME",link:"/"},{text:"CART",link:"/cart"},{text:"CHECKOUT"}];function d(e){let{isLoggedIn:t}=e,n=(0,s.useRouter)();return(0,r.jsxs)("div",{className:"space-y-6 lg:space-y-10",children:[(0,r.jsxs)("div",{className:"font-semibold text-sm font-secondary text-[var(--color-secondary-400)] flex items-center w-full justify-between",children:[(0,r.jsx)(o.A,{items:c}),(0,r.jsxs)("div",{className:"flex items-center gap-1 cursor-pointer",children:[t?(0,r.jsx)(l.A,{onClick:()=>n.push("/"),className:"p-0 text-xs md:text-sm lg:text-base",content:"CONTINUE SHOPPING",variant:"tertiary"}):(0,r.jsx)(l.A,{onClick:()=>n.push("/account/login"),className:"p-0 text-xs md:text-sm lg:text-base",content:"LOG IN",variant:"tertiary"}),(0,r.jsx)("span",{className:"size-5 text-[var(--color-primary-600)]",children:i.H})]})]}),(0,r.jsx)("h1",{className:"font-primary font-normal text-2xl md:text-3xl lg:text-4xl uppercase text-[var(--color-secondary-800)p-0]",children:"Checkout"})]})}var u=n(91942);function h(e){let{isLoggedIn:t,userEmail:n,guestEmail:a,onEmailChange:s,emailError:o}=e;return t?(0,r.jsx)("div",{className:"space-y-5",children:(0,r.jsx)(u.A,{disabled:!0,readOnly:!0,label:"EMAIL",name:"email",type:"email",value:n||"",className:"py-1"})}):(0,r.jsx)("div",{children:(0,r.jsx)(u.A,{label:"EMAIL",name:"email",type:"email",value:a,onChange:s,required:!0,hasError:!!o,errorMessage:o||void 0,className:"py-1"})})}var m=n(39208);function p(e){let{checkoutId:t,canShowDeliveryMethods:n,hasCompleteShippingInfo:a,missingForDelivery:s,shippingLoading:o,shippingMethods:l,shippingError:i,selectedShippingId:c,isUpdatingDelivery:d,isProcessingSelection:u=!1,isWillCallSelected:h=!1,onShippingMethodSelect:p,onRetryShippingMethods:y}=e;if(!t)return null;let g=(()=>{let e=l.find(e=>{var t,n;return(null==(t=e.name)?void 0:t.toLowerCase().includes("free shipping"))&&(null==(n=e.price)?void 0:n.amount)===0});return e?[e]:l})();return(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-base font-semibold font-secondary text-[var(--color-secondary-800)] mb-3 uppercase",children:["Delivery Method"," ",!h&&(d||o||u)&&(0,r.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"(updating…)"})]}),(0,r.jsxs)(r.Fragment,{children:[!n&&(0,r.jsxs)("div",{className:"text-xs font-secondary text-white bg-[var(--color-secondary-100)] border border-[var(--color-secondary-200)] p-2  flex items-start gap-2",children:[(0,r.jsx)("span",{children:m.w}),(0,r.jsxs)("p",{children:["Delivery methods will be available once you complete the shipping address."," ",!a&&s.length>0&&(0,r.jsxs)("span",{children:["Missing: ",s.join(", ")]})]})]}),!o&&!d&&i&&(0,r.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 border border-red-200 rounded p-3",children:[(0,r.jsx)("p",{className:"font-medium",children:i.includes("postal code")?"Address Validation Error":i.includes("session")||i.includes("expired")||i.includes("timeout")?"Session Issue":"Delivery Method Error"}),(0,r.jsx)("p",{className:"text-xs mt-1",children:i}),(i.includes("session")||i.includes("expired")||i.includes("timeout")||i.includes("network")||i.includes("Failed to fetch"))&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"This might be due to a session timeout or network issue. Please try refreshing or retrying."}),y&&(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:y,disabled:o||d,className:"px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:o?"Retrying...":"Retry"}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),disabled:o||d,className:"px-3 py-1.5 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Refresh Page"})]})]}),i.includes("not applicable")&&(0,r.jsx)("p",{className:"text-xs mt-2 text-gray-600",children:"This can happen if the shipping method does not support your address, product's weight/size, or geographic region."}),i.includes("no longer available")&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"The selected shipping method is no longer available. This can happen if inventory or shipping options have changed."}),y&&(0,r.jsx)("button",{onClick:y,disabled:o||d,className:"px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:o?"Refreshing...":"Refresh Methods"})]})]}),(!o&&!d&&g.length>0&&!i&&n||h&&g.length>0)&&(0,r.jsxs)("div",{children:[l.length>g.length&&(0,r.jsxs)("div",{className:"mb-4 text-sm text-green-700 bg-green-50 border border-green-200 rounded p-3",children:[(0,r.jsx)("p",{className:"font-medium",children:"Free Shipping Available!"}),(0,r.jsx)("p",{className:"text-xs mt-1",children:"Your order qualifies for free shipping."})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:g.map(e=>{let t=null!=e.minimumDeliveryDays&&null!=e.maximumDeliveryDays?"".concat(e.minimumDeliveryDays,"-").concat(e.maximumDeliveryDays," days"):void 0,n=d||o||u;return(0,r.jsxs)("label",{className:"flex items-center gap-3 ring-1 p-2 transition-all duration-200 ".concat(n?"cursor-not-allowed opacity-50 pointer-events-none":"cursor-pointer"," ").concat(c===e.id?"ring-[var(--color-primary-100)] bg-[var(--color-primary-50)] text-[var(--color-primary-700)] accent-[var(--color-primary-600)]":"ring-gray-300 hover:bg-gray-50"," ").concat(n?"":"hover:bg-gray-50"),children:[(0,r.jsx)("input",{type:"radio",name:"delivery",disabled:n,checked:c===e.id,onChange:()=>!n&&p(e.id)}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-medium text-base/none font-secondary",children:e.name}),t&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:t})]}),(0,r.jsx)("div",{className:"font-medium text-base/none",children:new Intl.NumberFormat(void 0,{style:"currency",currency:e.price.currency}).format(e.price.amount)})]},e.id)})})]}),!o&&!d&&!i&&0===g.length&&n&&(0,r.jsxs)("div",{className:"text-sm text-gray-600 bg-yellow-50 border border-yellow-200 rounded p-3",children:[(0,r.jsx)("p",{className:"font-medium text-yellow-800",children:"No delivery methods found"}),(0,r.jsx)("p",{className:"text-xs mt-1",children:"No shipping methods are available for this address. This could be due to:"}),(0,r.jsxs)("ul",{className:"text-xs mt-2 list-disc list-inside text-gray-600",children:[(0,r.jsx)("li",{children:"Invalid or incomplete address"}),(0,r.jsx)("li",{children:"No shipping zones configured for this location"}),(0,r.jsx)("li",{children:"Address verification issues"})]}),(0,r.jsx)("p",{className:"text-xs mt-2 text-gray-500",children:"Try updating your address or contact support if the issue persists."})]})]})]})}var y=n(7620),g=n(61773);function f(e){var t,n,a;let{totalAmount:s,selectedShipping:o,grandTotal:i,saleorTotal:c,isUpdatingDelivery:d,shippingLoading:u,isCalculatingTotal:h,taxInfo:m,isCalculatingTax:p,voucherInfo:f,onApplyVoucher:v,onRemoveVoucher:x,isApplyingVoucher:b=!1,voucherError:w,selectedCollectionPointId:k,onCompletePayment:N,isPaymentProcessing:C=!1,paymentDisabled:j=!1,paymentDisabledReason:P}=e,[S,E]=(0,y.useState)(""),I=async()=>{S.trim()&&v&&(await v(S.trim()),w||E(""))},A=async()=>{x&&(await x(),E(""))},T=!o&&!k||b||!S.trim();return(0,r.jsxs)("div",{className:"lg:col-span-1 flex flex-col lg:sticky lg:top-24 lg:self-start",children:[(0,r.jsx)("h2",{className:"font-medium font-secondary text-base text-[var(--color-secondary-800)] text-start pb-3 uppercase",children:"Summary"}),(0,r.jsxs)("div",{className:"bg-white border border-[var(--color-secondary-200)] rounded-lg p-6 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-4 border-b border-gray-200",children:[(0,r.jsx)(g.default,{src:"/icons/visa.gif",alt:"Visa",width:40,height:25,className:"object-contain"}),(0,r.jsx)(g.default,{src:"/icons/master.gif",alt:"Mastercard",width:40,height:25,className:"object-contain"}),(0,r.jsx)(g.default,{src:"/icons/amex.gif",alt:"American Express",width:40,height:25,className:"object-contain"}),(0,r.jsx)(g.default,{src:"/icons/discover.gif",alt:"Discover",width:40,height:25,className:"object-contain"})]}),(0,r.jsxs)("div",{className:"w-full text-normal text-[var(--color-secondary-600)] text-base",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{children:"Sub-Total"}),(0,r.jsx)("span",{className:"font-medium",children:m&&m.subtotalNet>0?new Intl.NumberFormat(void 0,{style:"currency",currency:m.currency}).format(m.subtotalNet):"$".concat(s.toFixed(2))})]}),(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{children:"Tax"}),(0,r.jsx)("span",{className:"font-medium",children:p?"Calculating…":m&&m.totalTax>0?new Intl.NumberFormat(void 0,{style:"currency",currency:m.currency}).format(m.totalTax):"N/A"})]}),(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{children:"Shipping Cost"}),(0,r.jsx)("span",{className:"font-medium",children:d||u?"Updating…":o?new Intl.NumberFormat(void 0,{style:"currency",currency:o.price.currency}).format(o.price.amount):"--"})]}),m&&m.shippingTax>0&&(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm text-start",children:"Shipping Tax"}),(0,r.jsx)("span",{className:"font-medium text-sm",children:new Intl.NumberFormat(void 0,{style:"currency",currency:m.currency}).format(m.shippingTax)})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-4 mt-4",children:(null==f?void 0:f.voucherCode)?(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsxs)("span",{className:"text-green-600 font-medium",children:["Voucher Applied: ",f.voucherCode]}),(0,r.jsx)("button",{onClick:A,className:"text-sm hover:underline ".concat(b?"text-gray-400 cursor-not-allowed":"text-red-500"),disabled:b,children:b?"Removing...":"Remove"})]}),f.discount&&(0,r.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,r.jsx)("span",{children:"Discount"}),(0,r.jsxs)("span",{className:"font-medium",children:["-",new Intl.NumberFormat(void 0,{style:"currency",currency:f.discount.currency}).format(f.discount.amount)]})]})]}):(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-[var(--color-secondary-800)] mb-2",children:"Have a voucher code?"}),!o&&!k&&(0,r.jsx)("p",{className:"text-orange-600 text-xs mb-3 bg-orange-50 p-2 rounded border border-orange-200",children:"Please select a delivery method or pickup location first to apply a voucher code"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:S,onChange:e=>E(e.target.value),placeholder:"Enter voucher code",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent ".concat(o||k?"border-gray-300":"bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed"),disabled:!o&&!k||b,onKeyDown:e=>{"Enter"!==e.key||T||I()}}),(0,r.jsx)("button",{onClick:I,disabled:T,className:"px-4 py-2 text-sm font-medium rounded-md ".concat(T?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[var(--color-primary)] text-white hover:bg-[var(--color-primary)]/90"),children:b?"Applying...":"Apply"})]}),w&&(0,r.jsx)("p",{className:"text-red-500 text-xs",children:w})]})]})}),(0,r.jsxs)("div",{className:"flex justify-between text-xl text-[var(--color-secondary-600)] font-semibold font-secondary mt-2 pt-4 border-t border-gray-200",children:[(0,r.jsx)("span",{className:"font-medium",children:"TOTAL"}),(0,r.jsx)("div",{className:"text-right",children:(null==f?void 0:f.discount)&&f.discount.amount>0&&c?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 line-through",children:new Intl.NumberFormat(void 0,{style:"currency",currency:(null==o||null==(t=o.price)?void 0:t.currency)||(null==m?void 0:m.currency)||"USD"}).format(c+f.discount.amount)}),(0,r.jsx)("div",{className:"text-[var(--color-secondary-800)] ".concat(h||p?"opacity-60":""),children:h||p?"Calculating…":new Intl.NumberFormat(void 0,{style:"currency",currency:(null==o||null==(n=o.price)?void 0:n.currency)||(null==m?void 0:m.currency)||"USD"}).format(c)})]}):(0,r.jsx)("span",{className:"text-[var(--color-secondary-800)] ".concat(h||p?"opacity-60":""),children:h||p?"Calculating…":new Intl.NumberFormat(void 0,{style:"currency",currency:(null==o||null==(a=o.price)?void 0:a.currency)||(null==m?void 0:m.currency)||"USD"}).format(c||i)})})]}),N&&(0,r.jsx)(l.A,{onClick:()=>N(),content:C?"Processing...":j&&P?P:"PLACE ORDER",disabled:j||C,variant:"primary",className:"w-full mt-6",type:"button"})]})]})]})}var v=n(59382),x=n(47294),b=n(46590),w=n(26177);function k(){let e=(0,b._)(["\n  query GetCheckoutCollectionPoints($checkoutId: ID!) {\n    checkout(id: $checkoutId) {\n      id\n      availableCollectionPoints {\n        id\n        name\n        clickAndCollectOption\n        isPrivate\n        address {\n          streetAddress1\n          city\n          postalCode\n          countryArea\n          country {\n            code\n            country\n          }\n        }\n      }\n    }\n  }\n"]);return k=function(){return e},e}let N=(0,w.J1)(k());function C(){let e=(0,b._)(["\n  mutation CheckoutDeliveryMethodUpdateWillCall($id: ID!, $deliveryMethodId: ID!) {\n    checkoutDeliveryMethodUpdate(\n      id: $id\n      deliveryMethodId: $deliveryMethodId\n    ) {\n      checkout {\n        id\n        deliveryMethod {\n          __typename\n          ... on Warehouse {\n            id\n            name\n          }\n          ... on ShippingMethod {\n            id\n            name\n          }\n        }\n        subtotalPrice {\n          gross {\n            amount\n            currency\n          }\n          net {\n            amount\n            currency\n          }\n          tax {\n            amount\n            currency\n          }\n        }\n      }\n      errors {\n        field\n        message\n        code\n      }\n    }\n  }\n"]);return C=function(){return e},e}let j=(0,w.J1)(C());var P=n(81918),S=n(64026),E=n(27400),I=n(2244),A=n(21447),T=n(4881),D=n(57763),M=n(99921),U=n(78604),F=n(35773),_=n(24338);let R=(0,a.default)(()=>Promise.all([n.e(4159),n.e(5824),n.e(2922),n.e(2918)]).then(n.bind(n,62918)),{loadableGenerated:{webpack:()=>[62918]},loading:()=>(0,r.jsx)("div",{className:"animate-pulse h-48 bg-gray-100 rounded"})}),$=(0,a.default)(()=>n.e(9671).then(n.bind(n,9671)),{loadableGenerated:{webpack:()=>[9671]},loading:()=>(0,r.jsx)("div",{className:"animate-pulse h-32 bg-gray-100 rounded"})}),L=(0,a.default)(()=>n.e(8206).then(n.bind(n,98206)),{loadableGenerated:{webpack:()=>[98206]},loading:()=>(0,r.jsx)("div",{className:"animate-pulse h-32 bg-gray-100 rounded"})}),O=(0,a.default)(()=>n.e(163).then(n.bind(n,163)),{loadableGenerated:{webpack:()=>[163]},loading:()=>(0,r.jsx)("div",{className:"animate-pulse h-48 bg-gray-100 rounded"}),ssr:!1}),z=(0,a.default)(()=>Promise.all([n.e(498),n.e(3533)]).then(n.bind(n,53533)),{loadableGenerated:{webpack:()=>[53533]},loading:()=>(0,r.jsx)("div",{className:"animate-pulse h-24 bg-gray-100 rounded"})}),q=(0,a.default)(()=>n.e(3035).then(n.bind(n,23035)),{loadableGenerated:{webpack:()=>[23035]},ssr:!1}),B=(e,t)=>{if(e===t)return!0;if(!e||!t)return!1;let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r of n)if(e[r]!==t[r])return!1;return!0},G=e=>new Promise(t=>setTimeout(t,e));async function J(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;for(let a=0;a<n;a++)try{return await e()}catch(n){t=n;let e=r*Math.pow(2,a)+Math.floor(50*Math.random());await G(e)}throw t instanceof Error?t:Error("Operation failed after retries")}function V(e){let t=Error(e);return t.isDeliveryMethodError=!0,t}function H(){var e;let{cartItems:t,totalAmount:n,isLoggedIn:a,guestEmail:o,guestShippingInfo:l,checkoutId:i,setCheckoutId:c,checkoutToken:u,setCheckoutToken:m,selectedShippingMethodId:g,setSelectedShippingMethodId:b}=(0,S.o)(),k=(0,S.o)(e=>e.user),{getGoogleTagManagerConfig:C,isWillCallEnabled:H}=(0,U.h)(),Y=C(),K=(0,s.useRouter)(),X=(0,E.m)(),[Z,Q]=(0,y.useState)(!1),[W,ee]=(0,y.useState)([]),[et,en]=(0,y.useState)(!1),[er,ea]=(0,y.useState)(null),[es,eo]=(0,y.useState)(null),[el,ei]=(0,y.useState)(null),[ec,ed]=(0,y.useState)(!1),[eu,eh]=(0,y.useState)(!1),[em,ep]=(0,y.useState)(!0),[ey,eg]=(0,y.useState)({isModalOpen:!1,paymentProcessingLoading:!1,error:!1,success:!1}),[ef,ev]=(0,y.useState)(null),[ex,eb]=(0,y.useState)(null),[ew,ek]=(0,y.useState)(!1),[eN,eC]=(0,y.useState)(!1),[ej,eP]=(0,y.useState)(!1),[eS,eE]=(0,y.useState)(!1),[eI,eA]=(0,y.useState)({fn:null}),[eT,eD]=(0,y.useState)(!1),[eM,eU]=(0,y.useState)(null),[,eF]=(0,y.useState)({}),[e_,eR]=(0,y.useState)(!0),[e$,eL]=(0,y.useState)(null),[eO,ez]=(0,y.useState)(!1),[eq,eB]=(0,y.useState)(!1),[eG,eJ]=(0,y.useState)([]),[eV,eH]=(0,y.useState)(!1),[eY,eK]=(0,y.useState)(null),[eX,eZ]=(0,y.useState)(!1),[eQ,eW]=(0,y.useState)(null),[e0,e1]=(0,y.useState)(null),[e2,e3]=(0,y.useState)(!1),[e5,e4]=(0,y.useState)(null),[e6,e8]=(0,y.useState)([]),[e7,e9]=(0,y.useState)(null),[te,tt]=(0,y.useState)(!1),[tn,tr]=(0,y.useState)(!1),[ta,ts]=(0,y.useState)(null),{data:to}=(0,I.IT)(v.J,{variables:{slug:"checkout-terms-and-conditions"},fetchPolicy:"cache-first"}),tl=(0,y.useRef)(!1),ti=(0,y.useRef)(!1),tc=(0,y.useRef)(null),td=(0,y.useRef)(""),tu=(0,y.useRef)(0),th=(0,y.useRef)(null),tm=(0,y.useRef)(new Set),[tp,ty]=(0,y.useState)({firstName:"",lastName:"",address:"",city:"",state:"",zipCode:"",email:"",phone:"",country:"US"}),tg=(0,y.useCallback)(e=>e&&""!==e.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Please enter a valid email address.":"Email address is required.",[]),tf=(0,y.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"operation",n=e instanceof Error?e.message:String(e);return n.includes("Couldn't resolve to a node")?(console.error("".concat(t," failed: Checkout session expired"),e),Error("Your checkout session has expired. Please refresh the page to start a new checkout session.")):n.includes("session")||n.includes("expired")||n.includes("401")||n.includes("403")?(console.error("".concat(t," failed: Session expired"),e),Error("Your session has expired. Please refresh the page and try again.")):n.includes("network")||n.includes("Failed to fetch")||n.includes("NetworkError")?(console.error("".concat(t," failed: Network error"),e),Error("Network connection issue. Please check your connection and try again.")):(console.error("".concat(t," failed:"),e),Error(n||"".concat(t," failed. Please try again.")))},[]),tv=(0,y.useCallback)((e,t)=>{if(!e||!t)return!1;let n=e.trim();if(0===n.length)return!1;let r={US:/^\d{5}(-\d{4})?$/,CA:/^[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d$/,UK:/^[A-Za-z]{1,2}\d[A-Za-z\d]?\s?\d[A-Za-z]{2}$/,AU:/^\d{4}$/,DE:/^\d{5}$/,FR:/^\d{5}$/,JP:/^\d{3}-?\d{4}$/,PK:/^\d{5}$/}[t];return r?r.test(n):/^[A-Za-z0-9\s-]{3,10}$/.test(n)},[]),tx=(0,y.useMemo)(()=>{let e=[];return tp.firstName||e.push("First name"),tp.lastName||e.push("Last name"),tp.address||e.push("Street address"),tp.city||e.push("City"),tp.zipCode?tv(tp.zipCode,tp.country)||e.push("Valid postal code"):e.push("Postal code"),tp.country||e.push("Country"),e},[tp,tv]),[tb,tw]=(0,y.useState)({firstName:"",lastName:"",address:"",city:"",state:"",zipCode:"",country:"US",phone:"",email:""}),[tk,tN]=(0,y.useState)({firstName:"",lastName:"",phone:"",companyName:"",streetAddress1:"",streetAddress2:"",city:"",postalCode:"",country:"US",countryArea:""});(0,y.useEffect)(()=>Q(!0),[]),(0,y.useEffect)(()=>{Z&&(async()=>{e3(!0),e4(null);try{let e=await F.u.getKountConfig();e1(e)}catch(t){let e=t instanceof Error?t.message:"Failed to fetch fraud detection configuration";e4(e),e.includes("not configured")||console.error("Failed to fetch Kount configuration:",t)}finally{e3(!1)}})()},[Z]);let tC=(0,y.useCallback)(()=>{ee([]),en(!1),ea(null),ei(null),ed(!1),ek(!1),eC(!1),eP(!1),eE(!1),ev(null),eb(null),tl.current=!1,ti.current=!1,td.current="",t8.current=null,t4.current=null,t6.current=null,tu.current=0,tm.current.clear(),b(null),tc.current&&(tc.current.abort(),tc.current=null),th.current&&(clearTimeout(th.current),th.current=null)},[b]);(0,y.useEffect)(()=>{if(Z)try{let e=new URL(window.location.href).searchParams.get("checkoutId"),t=localStorage.getItem("checkoutId"),n=localStorage.getItem("checkoutToken"),r=e||t||null;r&&r!==i&&(c(r),b(null)),n&&n!==u&&(null==m||m(n)),e&&e!==t&&localStorage.setItem("checkoutId",e)}catch(e){}},[Z,i,u,c,m,b]);let tj=(0,y.useMemo)(()=>{let e=_.env.NEXT_PUBLIC_API_URL||"/api/graphql",t=e.trim().toLowerCase();return/\/graphql\/?$/.test(t)?e.trim():e.replace(/\/+$/,"")+"/graphql"},[]),tP=(0,y.useCallback)(async(e,t)=>{var n,r,a,s,o,l,i,c,d,u,h,m,p,y,g,f,v;let x=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n        mutation CheckoutShippingAddressUpdate($checkoutId: ID!, $shippingAddress: AddressInput!) {\n          checkoutShippingAddressUpdate(checkoutId: $checkoutId, shippingAddress: $shippingAddress) {\n            checkout {\n              id\n              shippingAddress {\n                streetAddress1\n                city\n                postalCode\n                country {\n                  code\n                }\n                countryArea\n              }\n              totalPrice {\n                gross {\n                  amount\n                  currency\n                }\n                net {\n                  amount\n                  currency\n                }\n                tax {\n                  amount\n                  currency\n                }\n              }\n              shippingPrice {\n                gross {\n                  amount\n                  currency\n                }\n                net {\n                  amount\n                  currency\n                }\n                tax {\n                  amount\n                  currency\n                }\n              }\n              subtotalPrice {\n                gross {\n                  amount\n                  currency\n                }\n                net {\n                  amount\n                  currency\n                }\n                tax {\n                  amount\n                  currency\n                }\n              }\n              lines {\n                quantity\n                totalPrice {\n                  gross {\n                    amount\n                    currency\n                  }\n                  net {\n                    amount\n                    currency\n                  }\n                  tax {\n                    amount\n                    currency\n                  }\n                }\n                variant {\n                  id\n                  name\n                }\n              }\n            }\n            errors {\n              field\n              message\n            }\n          }\n        }\n      ",variables:{checkoutId:e,shippingAddress:t}})});if(!x.ok)throw Error("Failed to update shipping address");let b=await x.json(),w=null==(r=b.data)||null==(n=r.checkoutShippingAddressUpdate)?void 0:n.errors;if(null==w?void 0:w.length)throw Error((null==(a=w[0])?void 0:a.message)||"Shipping address update error");let k=null==(o=b.data)||null==(s=o.checkoutShippingAddressUpdate)?void 0:s.checkout;if(k)try{let e=(null==(i=k.subtotalPrice)||null==(l=i.tax)?void 0:l.amount)||0,t=(null==(d=k.shippingPrice)||null==(c=d.tax)?void 0:c.amount)||0,n=(null==(h=k.subtotalPrice)||null==(u=h.net)?void 0:u.amount)||0,r=(null==(p=k.shippingPrice)||null==(m=p.net)?void 0:m.amount)||0,a=(null==(g=k.totalPrice)||null==(y=g.gross)?void 0:y.currency)||"USD";eb({totalTax:e,shippingTax:t,subtotalNet:n,shippingNet:r,currency:a});let s=null==(v=k.totalPrice)||null==(f=v.gross)?void 0:f.amount;"number"==typeof s&&ev(s)}catch(e){console.warn("Failed to parse tax information:",e)}},[tj]),tS=(0,y.useCallback)(async(e,t)=>{try{var n,r,a;let s=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation CheckoutBillingAddressUpdate($id: ID!, $billingAddress: AddressInput!) {\n    checkoutBillingAddressUpdate(id: $id, billingAddress: $billingAddress) {\n      checkout { id }\n      errors { field message }\n    }\n  }\n",variables:{id:e,billingAddress:t}})});if(!s.ok)throw Error("Failed to update billing address");let o=await s.json();if(o.errors&&o.errors.length>0){let e=o.errors[0];throw tf(e,"Billing address update")}let l=null==(r=o.data)||null==(n=r.checkoutBillingAddressUpdate)?void 0:n.errors;if(null==l?void 0:l.length){let e=(null==(a=l[0])?void 0:a.message)||"Billing address update error";throw tf(Error(e),"Billing address update")}}catch(e){if(e instanceof Error&&(e.message.includes("checkout session")||e.message.includes("session has expired")))throw e;throw tf(e,"Billing address update")}},[tj,tf]),tE=(0,y.useCallback)(async(e,t,n)=>{try{var r,a,s;let o=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation CheckoutEmailUpdate($checkoutId: ID!, $email: String!) {\n    checkoutEmailUpdate(checkoutId: $checkoutId, email: $email) {\n      checkout {\n        id\n        email\n      }\n      errors {\n        field\n        message\n        code\n      }\n    }\n  }\n",variables:{checkoutId:e,email:t}})});if(!o.ok)throw Error("Failed to update checkout email");let l=await o.json();if(l.errors&&l.errors.length>0){let e=l.errors[0].message||"GraphQL error";n&&n(e);return}let i=null==(a=l.data)||null==(r=a.checkoutEmailUpdate)?void 0:r.errors;if(null==i?void 0:i.length){let e=(null==(s=i[0])?void 0:s.message)||"Email update error";n&&n(e);return}}catch(t){let e=t instanceof Error?t.message:"Email update failed";n&&n(e)}},[tj]),tI=(0,y.useCallback)(async(e,t)=>{try{var n,r,a,s,o;let l=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  query GetCheckoutDetails($id: ID!) {\n    checkout(id: $id) {\n      id\n      voucherCode\n      discount {\n        amount\n        currency\n      }\n      totalPrice { \n        gross { \n          amount \n          currency \n        } \n      }\n      subtotalPrice { \n        gross { \n          amount \n          currency \n        } \n      }\n      deliveryMethod {\n        ... on ShippingMethod {\n          id\n          name\n          price { \n            amount \n            currency \n          }\n        }\n      }\n      lines {\n        id\n        quantity\n        totalPrice { \n          gross { \n            amount \n            currency \n          } \n        }\n        variant {\n          id\n          name\n          pricing {\n            price { \n              gross { \n                amount \n                currency \n              } \n            }\n            priceUndiscounted { \n              gross { \n                amount \n                currency \n              } \n            }\n          }\n          product {\n            id\n            name\n            thumbnail { \n              url \n            }\n            pricing {\n              onSale\n              priceRange {\n                start { \n                  gross { \n                    amount \n                    currency \n                  } \n                }\n                stop { \n                  gross { \n                    amount \n                    currency \n                  } \n                }\n              }\n              discount { \n                gross { \n                  amount \n                  currency \n                } \n              }\n            }\n            metadata {\n              key\n              value\n            }\n          }\n        }\n      }\n    }\n  }\n",variables:{id:e}}),signal:t});if(!l.ok)throw Error("Failed to fetch checkout details");let i=await l.json();if(i.errors&&i.errors.length>0){let e=i.errors[0];throw tf(e,"Get checkout details")}let c=null==(n=i.data)?void 0:n.checkout;if(!c)throw tf(Error("Unable to determine checkout details"),"Get checkout details");let d=null==(a=c.totalPrice)||null==(r=a.gross)?void 0:r.amount,u=null==(o=c.subtotalPrice)||null==(s=o.gross)?void 0:s.amount,h=c.lines||[],m=c.deliveryMethod,p=c.voucherCode||null,y=c.discount?{amount:c.discount.amount,currency:c.discount.currency}:null;return{total:d,subtotal:u,lines:h,deliveryMethod:m,voucherInfo:{voucherCode:p,discount:y},fullCheckoutData:c}}catch(e){if(e instanceof Error&&(e.message.includes("checkout session")||e.message.includes("session has expired")))throw e;throw tf(e,"Get checkout details")}},[tj,tf]),tA=(0,y.useCallback)(async(e,t)=>{if(!ti.current){ti.current=!0;try{var n,r,a,s,o,l,i,c,d,u,h,m,p,y,g,f,v;let x=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation CheckoutDeliveryMethodUpdate($id: ID!, $deliveryMethodId: ID!) {\n    checkoutDeliveryMethodUpdate(id: $id, deliveryMethodId: $deliveryMethodId) {\n      checkout { \n        id\n        totalPrice {\n          gross {\n            amount\n            currency\n          }\n          net {\n            amount\n            currency\n          }\n          tax {\n            amount\n            currency\n          }\n        }\n        shippingPrice {\n          gross {\n            amount\n            currency\n          }\n          net {\n            amount\n            currency\n          }\n          tax {\n            amount\n            currency\n          }\n        }\n        subtotalPrice {\n          gross {\n            amount\n            currency\n          }\n          net {\n            amount\n            currency\n          }\n          tax {\n            amount\n            currency\n          }\n        }\n      }\n      errors { field message }\n    }\n  }\n",variables:{id:e,deliveryMethodId:t}})});if(!x.ok){let e=await x.text();throw Error("Failed to set delivery method: ".concat(x.status," ").concat(x.statusText," ").concat(e))}let b=await x.json();if(b.errors&&b.errors.length>0){let e=b.errors[0];throw tf(e,"Delivery method update")}let w=null==(r=b.data)||null==(n=r.checkoutDeliveryMethodUpdate)?void 0:n.errors;if(null==w?void 0:w.length){let e=w.map(e=>"".concat(e.field||"unknown",": ").concat(e.message||"unknown")).join(", "),t=(null==(o=w[0])?void 0:o.message)||"Delivery method update error: ".concat(e);throw tf(Error(t),"Delivery method update")}let k=null==(s=b.data)||null==(a=s.checkoutDeliveryMethodUpdate)?void 0:a.checkout;if(k)try{let e=(null==(i=k.subtotalPrice)||null==(l=i.tax)?void 0:l.amount)||0,t=(null==(d=k.shippingPrice)||null==(c=d.tax)?void 0:c.amount)||0,n=(null==(h=k.subtotalPrice)||null==(u=h.net)?void 0:u.amount)||0,r=(null==(p=k.shippingPrice)||null==(m=p.net)?void 0:m.amount)||0,a=(null==(g=k.totalPrice)||null==(y=g.gross)?void 0:y.currency)||"USD";eb({totalTax:e,shippingTax:t,subtotalNet:n,shippingNet:r,currency:a});let s=null==(v=k.totalPrice)||null==(f=v.gross)?void 0:f.amount;"number"==typeof s&&ev(s)}catch(e){console.warn("Failed to parse tax information from delivery method update:",e)}}catch(e){if(e instanceof Error&&(e.message.includes("checkout session")||e.message.includes("session has expired")))throw e;throw tf(e,"Delivery method update")}finally{ti.current=!1}}},[tj,tf]),tT=(0,y.useCallback)(async e=>{if(!i)return void eW("No checkout session found");eZ(!0),eW(null);try{var t,n,r;let a=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation AddVoucherToCheckout($checkoutId: ID!, $promoCode: String!) {\n    checkoutAddPromoCode(checkoutId: $checkoutId, promoCode: $promoCode) {\n      checkout {\n        id\n        voucherCode\n        discount {\n          amount\n          currency\n        }\n        totalPrice {\n          gross {\n            amount\n            currency\n          }\n        }\n        subtotalPrice {\n          gross {\n            amount\n            currency\n          }\n        }\n      }\n      errors {\n        field\n        code\n        message\n      }\n    }\n  }\n",variables:{checkoutId:i,promoCode:e}})});if(!a.ok)throw Error("Failed to apply voucher: ".concat(a.status," ").concat(a.statusText));let s=await a.json();if(s.errors&&s.errors.length>0)throw Error(s.errors[0].message||"Failed to apply voucher");let o=null==(t=s.data)?void 0:t.checkoutAddPromoCode;if((null==o?void 0:o.errors)&&o.errors.length>0){let e=o.errors[0];switch(e.code){case"INVALID":eW("Promo code is invalid");break;case"VOUCHER_NOT_APPLICABLE":eW("Voucher is not applicable to this checkout");break;default:eW(e.message||"Failed to apply voucher")}return}if(null==o?void 0:o.checkout){let e=o.checkout;eK({voucherCode:e.voucherCode||null,discount:e.discount?{amount:e.discount.amount,currency:e.discount.currency}:null});let t=null==(r=e.totalPrice)||null==(n=r.gross)?void 0:n.amount;"number"==typeof t&&ev(t)}}catch(e){console.error("Error applying voucher:",e),eW(e instanceof Error?e.message:"Failed to apply voucher")}finally{eZ(!1)}},[i,tj]),tD=(0,y.useCallback)(async()=>{if(i&&(null==eY?void 0:eY.voucherCode)){eZ(!0),eW(null);try{var e,t,n;let r={checkoutId:i,promoCode:eY.voucherCode},a=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation RemoveVoucherFromCheckout($checkoutId: ID!, $promoCode: String!) {\n    checkoutRemovePromoCode(checkoutId: $checkoutId, promoCode: $promoCode) {\n      checkout {\n        id\n        voucherCode\n        discount {\n          amount\n          currency\n        }\n        totalPrice {\n          gross {\n            amount\n            currency\n          }\n        }\n        subtotalPrice {\n          gross {\n            amount\n            currency\n          }\n        }\n      }\n      errors {\n        field\n        code\n        message\n      }\n    }\n  }\n",variables:r})});if(!a.ok)throw Error("Failed to remove voucher: ".concat(a.status," ").concat(a.statusText));let s=await a.json();if(s.errors&&s.errors.length>0)throw Error(s.errors[0].message||"Failed to remove voucher");let o=null==(e=s.data)?void 0:e.checkoutRemovePromoCode;if((null==o?void 0:o.errors)&&o.errors.length>0)return void eW(o.errors[0].message||"Failed to remove voucher");if(null==o?void 0:o.checkout){let e=o.checkout;eK({voucherCode:e.voucherCode||null,discount:e.discount?{amount:e.discount.amount,currency:e.discount.currency}:null});let r=null==(n=e.totalPrice)||null==(t=n.gross)?void 0:t.amount;"number"==typeof r&&ev(r)}}catch(e){console.error("Error removing voucher:",e),eW(e instanceof Error?e.message:"Failed to remove voucher")}finally{eZ(!1)}}},[i,tj,null==eY?void 0:eY.voucherCode]),tM=(0,y.useCallback)(e=>{var t,n,r,a,s,o,l;return{firstName:(null==(t=e.firstName)?void 0:t.trim())||"",lastName:(null==(n=e.lastName)?void 0:n.trim())||"",streetAddress1:(null==(r=e.address)?void 0:r.trim())||"",city:(null==(a=e.city)?void 0:a.trim())||"",postalCode:(null==(s=e.zipCode)?void 0:s.trim())||"",country:e.country||"US",countryArea:(null==(o=e.state)?void 0:o.trim())||void 0,phone:(null==(l=e.phone)?void 0:l.trim())||null}},[]),tU=(0,y.useCallback)(e=>{var t,n;return{firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",streetAddress1:(null==e?void 0:e.streetAddress1)||"",city:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",country:(null==e||null==(t=e.country)?void 0:t.code)||"",countryArea:(null==e?void 0:e.countryArea)||void 0,phone:null!=(n=null==e?void 0:e.phone)?n:null}},[]);(0,y.useEffect)(()=>{a||ty(e=>({...e,firstName:l.firstName||"",lastName:l.lastName||"",address:l.address||"",city:l.city||"",state:l.state||"",zipCode:l.zipCode||"",email:o||"",phone:l.phone||"",country:l.country||e.country||"US"}))},[a,o,l]);let{data:tF,refetch:t_}=(0,I.IT)(P.D,{skip:!a,fetchPolicy:"cache-and-network"}),{data:tR}=(0,I.IT)((0,w.J1)("\n  query GetPaymentGateways($checkoutId: ID!) {\n    checkout(id: $checkoutId) {\n      availablePaymentGateways {\n        id\n        name\n        config {\n          field\n          value\n        }\n        currencies\n      }\n    }\n  }\n"),{variables:{checkoutId:i},skip:!i,fetchPolicy:"cache-and-network"}),[t$]=(0,A.n)(x.Y,{refetchQueries:[{query:P.D}]}),[tL]=(0,A.n)(j),tO=(0,y.useMemo)(()=>{var e,t;let n=null==tF?void 0:tF.me;if(!n||!(null==(e=n.addresses)?void 0:e.length))return null;let r=null==(t=n.defaultShippingAddress)?void 0:t.id;return(r?n.addresses.find(e=>e.id===r):n.addresses[0])||null},[tF]),tz=(0,y.useMemo)(()=>{var e,t;let n=null==tF?void 0:tF.me;if(!n||!(null==(e=n.addresses)?void 0:e.length))return null;let r=null==(t=n.defaultBillingAddress)?void 0:t.id;return(r?n.addresses.find(e=>e.id===r):n.addresses[0])||null},[tF]),[tq,tB]=(0,y.useState)(null),[tG,tJ]=(0,y.useState)(null),[tV,tH]=(0,y.useState)(!1);(0,y.useEffect)(()=>{if(a&&(null==tF?void 0:tF.me)){var e,t,n,r,s,o,l;let a=!1;if(!tq){let e=null==(t=tF.me.defaultShippingAddress)?void 0:t.id,s=null==(r=tF.me.addresses)||null==(n=r[0])?void 0:n.id,o=e||s;o&&(tB(o),a=!0)}if(!tG){let e=null==(s=tF.me.defaultBillingAddress)?void 0:s.id,t=null==(l=tF.me.addresses)||null==(o=l[0])?void 0:o.id,n=e||t;n&&tJ(n)}(a||tq||!(null==(e=tF.me.addresses)?void 0:e.length))&&setTimeout(()=>tH(!0),50)}else a||tH(!0)},[a,null==tF?void 0:tF.me,tq,tG]);let tY=async(e,t)=>{if(a&&e)try{var n,r,s;let{data:a}=await t$({variables:{id:e,type:t}});if(null==a||null==(r=a.accountSetDefaultAddress)||null==(n=r.errors)?void 0:n.length)throw Error((null==(s=a.accountSetDefaultAddress.errors[0])?void 0:s.message)||"Failed to update default address");"SHIPPING"===t?tB(e):tJ(e),await t_()}catch(e){console.error("Failed to set default ".concat(t.toLowerCase()," address:"),e)}};(0,y.useEffect)(()=>{var e;if(!a||!(null==tF||null==(e=tF.me)?void 0:e.addresses))return;let t=tF.me.addresses.find(e=>e.id===tq);t&&(ty(e=>{var n,r;return{...e,firstName:t.firstName||"",lastName:t.lastName||"",address:t.streetAddress1||"",city:t.city||"",state:t.countryArea||"",zipCode:t.postalCode||"",email:(null==(n=tF.me)?void 0:n.email)||e.email,phone:t.phone||"",country:(null==(r=t.country)?void 0:r.code)||e.country||"US"}}),td.current="",eb(null),eE(!1),er&&er.includes("No delivery methods found")&&(ea(null),tu.current=0,tl.current=!1,ee([])))},[a,tq,tF,er]);let tK=(0,y.useMemo)(()=>!!(tp.firstName&&tp.lastName&&tp.address&&tp.city&&tp.zipCode&&tp.country),[tp]),tX=(0,y.useMemo)(()=>{var e,t,n,r;if(eT&&eM)return{firstName:"Dealer",lastName:"Pickup",streetAddress1:eM.address.streetAddress1||"",city:eM.address.city||"",postalCode:eM.address.postalCode||"",country:(null==(e=eM.address.country)?void 0:e.code)||"US",countryArea:(null==(t=eM.address)?void 0:t.countryArea)||"",phone:eM.phone||null};if(a&&tq){let e=null==tF||null==(r=tF.me)||null==(n=r.addresses)?void 0:n.find(e=>e.id===tq);return e?tU(e):null}return a&&tO&&tV?tU(tO):tK?tM(tp):null},[eT,eM,a,tq,tF,tO,tV,tK,tp,tU,tM]),tZ=(0,y.useMemo)(()=>!!(tb.firstName&&tb.lastName&&tb.address&&tb.city&&tb.zipCode&&tb.country),[tb]),tQ=(0,y.useMemo)(()=>{if(eT)return!!eM;if(!tV)return!1;if(a){var e,t;let n=!!tq,r=null==tF||null==(t=tF.me)||null==(e=t.addresses)?void 0:e.some(e=>e.id===tq);return n&&r}return tK},[eT,eM,tV,a,tq,tF,tK]),tW=(0,y.useMemo)(()=>{var e,t,n,r;if(em){if(eT){if(a&&tq){let n=null==tF||null==(t=tF.me)||null==(e=t.addresses)?void 0:e.find(e=>e.id===tq);return n?tU(n):tX}return tK?tM(tp):tX}return tX&&tK?tX:null}if(a){let e=tG?null==tF||null==(r=tF.me)||null==(n=r.addresses)?void 0:n.find(e=>e.id===tG):tz;return e?tU(e):null}return tZ?tM(tb):null},[em,eT,a,tq,tF,tU,tX,tK,tp,tM,tG,tz,tb,tZ]),t0=(0,y.useCallback)(async e=>{if(tl.current)return await G(100),W;if(Date.now()-tu.current<200)return W;tl.current=!0,en(!0),ea(null);try{var t,n,r;let a=await fetch(tj,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n  query GetCheckoutShippingMethods($id: ID!) {\n    checkout(id: $id) {\n      id\n      availableShippingMethods {\n        id\n        name\n        price { amount currency }\n        minimumDeliveryDays\n        maximumDeliveryDays\n      }\n    }\n  }\n",variables:{id:e}})});if(!a.ok){let e="Failed to fetch shipping methods: ".concat(a.status," ").concat(a.statusText);throw 401===a.status||403===a.status?e="Your session has expired. Please refresh the page to continue.":408===a.status||504===a.status?e="Request timeout occurred. Please check your connection and try again.":a.status>=500&&(e="Server error occurred. Please try again in a moment."),Error(e)}let s=await a.json();if(s.errors)throw Error((null==(r=s.errors[0])?void 0:r.message)||"GraphQL error");let o=((null==(n=s.data)||null==(t=n.checkout)?void 0:t.availableShippingMethods)||[]).map(e=>{var t,n;return{id:e.id,name:e.name,price:{amount:e.price.amount,currency:e.price.currency},minimumDeliveryDays:null!=(t=e.minimumDeliveryDays)?t:null,maximumDeliveryDays:null!=(n=e.maximumDeliveryDays)?n:null}});if(ee(o),tu.current=Date.now(),o.length)ea(null),g&&(b(null),ed(!1)),el&&!(el&&o.some(e=>e.id===el))&&(ei(null),b(null),ed(!1));else ei(null),b(null),ed(!1),W.length>0?ea("No shipping methods available. This might be due to session expiry. Please refresh the page if the issue persists."):ea(null),tu.current=Date.now(),td.current||(td.current="no-methods-available");return o}catch(t){let e="Failed to load shipping methods";if(t instanceof Error)if("AbortError"===t.name)return W;else e=t.message.includes("Failed to fetch")||t.message.includes("NetworkError")?"Network connection issue. Please check your internet and try again.":t.message.includes("timeout")?"Request timeout. Please try again.":t.message;throw ea(e),t}finally{en(!1),tl.current=!1}},[tj]),t1=(0,y.useCallback)(async e=>{if(W.length>0)return W;try{return await t0(e)}catch(t){return console.warn("Failed to fetch shipping methods, retrying...",t),await J(async()=>await t0(e),2,1e3)}},[t0]),t2=(0,y.useCallback)(async()=>{if(i&&!et&&!ew){ea(null),ee([]),tu.current=0,td.current="";try{await t0(i)}catch(e){throw ea(e instanceof Error?e.message:"Failed to retry shipping methods"),e}}},[i,t0]),t3=(0,y.useCallback)(async e=>{if(e){tr(!0),ts(null);try{var t;let{data:n}=await X.query({query:N,variables:{checkoutId:e},fetchPolicy:"network-only"});(null==n||null==(t=n.checkout)?void 0:t.availableCollectionPoints)?e8(n.checkout.availableCollectionPoints):e8([])}catch(e){console.error("Failed to fetch collection points:",e),ts("Failed to load pickup locations"),e8([])}finally{tr(!1)}}},[X]),t5=(0,y.useCallback)(async e=>{if(i){eh(!0),e9(e),ei(null),b(null),ed(!1),tt(!0),eb(e=>e?{...e,shippingTax:0,shippingNet:0}:null),t8.current=null,ek(!0);try{var t,n,r,a,s,o,l;let c=await tL({variables:{id:i,deliveryMethodId:e}});if(null==(r=c.data)||null==(n=r.checkoutDeliveryMethodUpdate)||null==(t=n.errors)?void 0:t.length){let e=c.data.checkoutDeliveryMethodUpdate.errors[0];throw Error(e.message)}ed(!0);let d=null==(s=c.data)||null==(a=s.checkoutDeliveryMethodUpdate)?void 0:a.checkout;(null==d||null==(l=d.subtotalPrice)||null==(o=l.gross)?void 0:o.amount)!==void 0&&ev(d.subtotalPrice.gross.amount)}catch(e){console.error("Failed to set collection point:",e),ts(e instanceof Error?e.message:"Failed to set pickup location"),e9(null)}finally{ek(!1),eh(!1)}}},[i,tL]),t4=(0,y.useRef)(null),t6=(0,y.useRef)(null),t8=(0,y.useRef)(null),t7=(0,y.useRef)(null);(0,y.useEffect)(()=>{let e=!0,n=async()=>{if(!Z||!i||!tX)return;let n=er&&(er.includes("No delivery methods found")||er.includes("not valid for the address")||er.includes("postal code"));if(Date.now()-tu.current<300)return;if(t7.current&&t7.current!==i){tC(),t7.current=i,b(null);return}t7.current||(t7.current=i,b(null));let r=JSON.stringify({country:tX.country,postalCode:tX.postalCode,streetAddress1:tX.streetAddress1,city:tX.city,phone:tX.phone}),a=!B(tX,t4.current),s=r!==td.current,o=0===W.length,l=!n&&(s||o&&tQ);if(!l||r!==td.current||!er){l&&tm.current.has(r)&&W.length;try{if(a&&(eE(!0),await tP(i,tX),t4.current=tX,eE(!1),t.length>0)){let e=t.map((e,t)=>({item_id:e.id,item_name:e.name,item_category:e.category||"Products",price:e.price,quantity:e.quantity,currency:"USD",index:t})),n=t.reduce((e,t)=>e+t.price*t.quantity,0),r={first_name:tX.firstName,last_name:tX.lastName,address_line_1:tX.streetAddress1,city:tX.city,state:tX.countryArea,postal_code:tX.postalCode,country:tX.country};(0,M.uR)(e,"USD",n,void 0,void 0,r,null==Y?void 0:Y.container_id)}l&&e&&!n&&(td.current=r,tm.current.add(r),await t0(i))}catch(t){e&&(eE(!1),ea(t instanceof Error?t.message:"Failed to sync shipping address"),td.current=r)}}};if(tQ||tX&&i){let t=setTimeout(()=>{e&&n()},150);return()=>{clearTimeout(t),e=!1}}return()=>{e=!1}},[Z,i,tQ,tX]),(0,y.useEffect)(()=>{(async()=>{if(Z&&i&&tW&&!B(tW,t6.current)){let e=["firstName","lastName","streetAddress1","city","postalCode","country"].filter(e=>!tW[e]);if(e.length>0)return console.warn("[Checkout] Billing sync skipped - missing fields:",e.join(", "));try{await tS(i,tW),t6.current=tW}catch(e){console.error("[Checkout] Billing sync error:",e instanceof Error?e.message:"Failed to sync billing address")}}})()},[Z,i,tW,tS]),(0,y.useEffect)(()=>{el&&t8.current!==el&&ev(null)},[el]),(0,y.useEffect)(()=>{let e=!0;return(async()=>{if(!i||!el||te)return;let t=W.find(e=>e.id===el);if(t||0!==W.length||(t=(await t1(i)).find(e=>e.id===el)),!t){ea("The selected shipping method is no longer available. Please select a different method."),ei(null),b(null),ed(!1);return}if(t8.current===el)return;let n=tX&&!B(tX,t4.current);try{if(n&&ek(!0),eC(!0),n&&(await tP(i,tX),t4.current=tX),!(t&&W.some(e=>e.id===el))&&(console.warn("Selected shipping method is no longer valid, fetching fresh methods..."),!(await t1(i)).find(e=>e.id===el)))throw Error("Selected shipping method ".concat(el," is no longer available. Please select a different method."));if(await tA(i,el),t8.current=el,tc.current&&tc.current.abort(),tc.current=new AbortController,e){let t=await tI(i,tc.current.signal);e&&!tc.current.signal.aborted&&(ev(t.total),eK(t.voucherInfo),ea(null),ed(!0))}}catch(t){if(e){let e="Failed to set delivery method";t instanceof Error&&(t.message.includes("checkout session")||t.message.includes("session has expired")||t.message.includes("Couldn't resolve to a node")?e="Your checkout session has expired. Please refresh the page or restart your checkout to continue.":t.message.includes("not applicable")?(e="This shipping method is not available for your address or items. Please select a different method.",ei(null),b(null),ed(!1)):e=t.message.includes("Failed to fetch")||t.message.includes("NetworkError")||t.message.includes("timeout")?"Network issue occurred. Please check your connection and try again.":t.message),ea(e)}}finally{e&&(ek(!1),eC(!1),eh(!1))}})(),()=>{e=!1}},[i,el,te,tX,t1,tA,tP,tI,b]),(0,y.useEffect)(()=>{(async()=>{if(!i||!tK){eJ([]),eH(!1);return}try{let e=await tI(i),t=((e,t,n)=>{let r=[];return(null==e?void 0:e.lines)&&e.lines.forEach(e=>{var a;let s=null==(a=e.variant)?void 0:a.product;if(!(null==s?void 0:s.metadata))return;let o=s.metadata,l=[],i=[],c="",d=!1;if(o.forEach(e=>{if("restricted_states"===e.key&&e.value)try{l=JSON.parse(e.value)}catch(t){console.warn("Failed to parse restricted_states:",e.value)}if("restricted_zip_codes"===e.key&&e.value)try{i=JSON.parse(e.value)}catch(t){console.warn("Failed to parse restricted_zip_codes:",e.value)}"checkout_message"===e.key&&e.value&&(c=e.value),"shipping_isactive"===e.key&&e.value&&(d="true"===e.value.toLowerCase())}),!d)return;let u=t&&l.includes(t.toUpperCase()),h=n&&i.some(e=>String(e)===n||String(e)===n.split("-")[0]);(u||h)&&c&&r.push({productName:s.name,checkoutMessage:c})}),r})(e.fullCheckoutData,tp.state,tp.zipCode);eJ(t),eH(t.length>0)}catch(e){console.warn("Failed to validate product restrictions:",e),eJ([]),eH(!1)}})()},[i,tK,tp.state,tp.zipCode,tI]),(0,y.useEffect)(()=>{if(!H()||!i||!tK)return void e8([]);t3(i)},[i,tK,H,t3]),(0,y.useEffect)(()=>{let e=new AbortController;return tc.current=e,(async()=>{if(i)try{eC(!0);let t=await tI(i,e.signal);e.signal.aborted||(ev(t.total),eK(t.voucherInfo),t.deliveryMethod?(ei(t.deliveryMethod.id),b(t.deliveryMethod.id),ed(!0),ee(e=>{var n,r;return e.find(e=>e.id===t.deliveryMethod.id)?e:[...e,{id:t.deliveryMethod.id,name:t.deliveryMethod.name,price:{amount:(null==(n=t.deliveryMethod.price)?void 0:n.amount)||0,currency:(null==(r=t.deliveryMethod.price)?void 0:r.currency)||"USD"}}]})):(ei(null),b(null),ed(!1)))}catch(e){e instanceof Error&&"AbortError"!==e.name&&ev(null)}finally{e.signal.aborted||eC(!1)}})(),()=>{e.abort(Error("Component unmounted"))}},[i,tI,b]);let t9=(0,y.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=a?null==k?void 0:k.email:tp.email;if(!t||""===t.trim())throw Error("Email address is required to complete your order.");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))throw Error("Please enter a valid email address.");if(a||(S.o.getState().setGuestEmail(tp.email),S.o.getState().setGuestShippingInfo({firstName:tp.firstName,lastName:tp.lastName,address:tp.address,city:tp.city,state:tp.state,zipCode:tp.zipCode,phone:tp.phone,country:tp.country})),!i)throw Error("Checkout ID is missing. Please refresh the page and try again.");if(!el&&!e7)throw V("Please select a delivery method or pickup location before completing your order.");if(e||e7)return;let n=W,r=n.find(e=>e.id===el);if(0===n.length||!r)try{if(r=(n=await t1(i)).find(e=>e.id===el),0===n.length)if(console.error("No shipping methods available after fresh fetch - this might be a temporary API issue"),el&&W.length>0)if(console.warn("Using previously validated shipping methods for payment completion"),r=(n=W).find(e=>e.id===el));else throw Error("No delivery methods are available and cached method is invalid. Please refresh the page and try again.");else throw Error("No delivery methods are available. This may be due to checkout session issues. Please refresh the page and try again.")}catch(e){if(e instanceof Error){if(e.message.includes("No delivery methods"))throw e;else if(e.message.includes("session")||e.message.includes("expired")||e.message.includes("401")||e.message.includes("403"))throw Error("Your checkout session has expired. Please refresh the page to start a new checkout session.");else if(e.message.includes("network")||e.message.includes("Failed to fetch"))throw Error("Network connection issue during checkout validation. Please check your connection and try again.")}throw Error("Unable to validate delivery methods during checkout. Please refresh the page and try again.")}if(!r)try{if(eP(!0),ea(null),ee([]),tu.current=0,td.current="",!(r=(n=await t0(i)).find(e=>e.id===el))){if(ei(null),b(null),ed(!1),0===n.length)throw V("No delivery methods are currently available for your address. Please verify your shipping address or contact support.");throw V("Your previously selected delivery method is no longer available. Please choose from the ".concat(n.length," available method").concat(n.length>1?"s":""," below and try again."))}}catch(e){if(e instanceof Error&&e.message.includes("No delivery methods")||e instanceof Error&&e.message.includes("available method"))throw e;throw V("The delivery method became unavailable during payment processing. Please select a new delivery method and try again.")}finally{eP(!1)}if(ew&&await G(300),el)try{await tA(i,el);let e=await fetch("".concat(_.env.NEXT_PUBLIC_API_URL||"/api/graphql"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n            query VerifyDeliveryMethod($checkoutId: ID!) {\n              checkout(id: $checkoutId) {\n                id\n                deliveryMethod {\n                  ... on ShippingMethod {\n                    id\n                    name\n                  }\n                }\n              }\n            }\n          ",variables:{checkoutId:i}})});if(e.ok){var s,o;let t=null==(o=(await e.json()).data)||null==(s=o.checkout)?void 0:s.deliveryMethod;if(!t||t.id!==el){console.warn("Delivery method verification failed, retrying...");try{await tA(i,el)}catch(e){console.warn("Retry also failed, but proceeding with payment since method was originally valid:",e)}}}else console.warn("Verification request failed, but proceeding with payment since method was originally valid")}catch(e){if(e instanceof Error){if(e.message.includes("Couldn't resolve to a node"))try{throw await t2(),ei(null),b(null),ed(!1),V("The delivery method became invalid during checkout. Fresh delivery options have been loaded - please select one and try again.")}catch(e){if(ei(null),b(null),ed(!1),e instanceof Error){if(e.message.includes("session")||e.message.includes("expired"))throw Error("Your session expired during checkout. The page will reload automatically to restore your session.");else if(e.message.includes("network")||e.message.includes("Failed to fetch"))throw V("Network connection issue during checkout. Please check your connection and try selecting a delivery method again.")}throw V("The delivery method became unavailable during payment processing. Please select a new delivery method and try again.")}else if(e.message.includes("not applicable"))throw ei(null),b(null),ed(!1),V("The selected shipping method is not available for your address or items. Please choose a different delivery method and try again.");throw V("Unable to confirm delivery method: ".concat(e.message))}throw V("Failed to confirm delivery method. Please refresh and try again.")}},[a,tp,i,el,e7,ew,tA,t1]),ne=(0,y.useMemo)(()=>W.find(e=>e.id===el)||null,[W,el]),nt=(0,y.useMemo)(()=>{var e;return"number"==typeof ef&&ef>0?ef:((null==ne||null==(e=ne.price)?void 0:e.amount)||0)+n},[ef,n,ne]),nn=(0,y.useRef)(null),nr=e=>{let{name:t,value:n}=e.target;if(ty(e=>({...e,[t]:n})),"email"===t){let e=tg(n);eo(e),nn.current&&clearTimeout(nn.current),!e&&!a&&i&&n.trim()&&(nn.current&&clearTimeout(nn.current),nn.current=setTimeout(()=>{tE(i,n,e=>{eo(e)})},1e3))}a||tV||tH(!0),["firstName","lastName","address","city","zipCode","state","country"].includes(t)&&(te&&(tt(!1),e9(null),ts(null),er&&(er.includes("click and collect")||er.includes("warehouse address"))&&ea(null)),eb(null),eE(!1),td.current="",tu.current=0,tl.current=!1,er&&(er.includes("No delivery methods found")||er.includes("not valid for the address")||er.includes("Delivery Method Error"))&&(ea(null),ee([])),er&&er.includes("postal code")&&(ea(null),td.current="",tu.current=0),th.current&&(clearTimeout(th.current),th.current=null),("state"===t||"country"===t)&&setTimeout(()=>{let e=new CustomEvent("revalidatePostalCode",{detail:{changedField:t,newValue:n}});window.dispatchEvent(e)},100)),"zipCode"===t&&(th.current=setTimeout(()=>{if(!et&&!ew){let e=tv(n,tp.country);!e&&n.length>=3?ea("Please enter a valid postal code for the selected country."):e&&er&&er.includes("postal code")&&(ea(null),td.current="",tu.current=0)}},1500))},na=async()=>{try{let e=em?tM(tp):tM(tb);i&&(await tS(i,e),await tP(i,tM(tp))),window.location.href="/order-confirmation".concat(i?"?checkoutId=".concat(encodeURIComponent(i)):"")}catch(e){console.error("Error during checkout:",e)}},ns=(0,y.useMemo)(()=>{var e,t;if("number"==typeof ef&&ef>0)return ef;if(ne&&n>0)return n+((null==(e=ne.price)?void 0:e.amount)||0);if(el&&W.length>0&&n>0){let e=W.find(e=>e.id===el);if(e)return n+((null==(t=e.price)?void 0:t.amount)||0)}return null},[ef,ne,n,el,W]);(0,y.useEffect)(()=>{let e=e=>{let{}=e.detail;if(tp.zipCode&&tp.zipCode.length>=3){let e=tv(tp.zipCode,tp.country);e&&er&&(er.includes("postal code")||er.includes("not valid for the address")||er.includes("Delivery Method Error"))?(ea(null),td.current="",tu.current=0,tl.current=!1,ee([])):e||ea("Please enter a valid postal code for the selected country.")}};return window.addEventListener("revalidatePostalCode",e),()=>{window.removeEventListener("revalidatePostalCode",e)}},[tp.zipCode,tp.country,er,tv]),(0,y.useEffect)(()=>()=>{tc.current&&tc.current.abort(),th.current&&clearTimeout(th.current)},[]);let no=(0,y.useCallback)(e=>{eA({fn:e})},[]);return Z?0!==t.length||i?(0,r.jsxs)("div",{className:"px-4 md:px-6 md:py-8 py-6 lg:max-w-7xl mx-auto lg:py-10",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-14",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-4 lg:border-r lg:border-[var(--color-secondary-200)] lg:pr-14",children:[(0,r.jsx)(d,{isLoggedIn:a}),(0,r.jsx)(h,{isLoggedIn:a,userEmail:null==k?void 0:k.email,guestEmail:tp.email,onEmailChange:nr,emailError:es}),(0,r.jsx)($,{isShipToDealer:eT,onShippingTypeChange:eD,selectedDealer:eM,onDealerSelect:eU}),!eT&&(0,r.jsx)(R,{isLoggedIn:a,shippingInfo:tp,billingInfo:tb,useShippingAsBilling:em,onShippingChange:nr,onBillingChange:e=>{let{name:t,value:n}=e.target;tw(e=>({...e,[t]:n}))},onUseShippingAsBillingChange:e=>{ep(e),e&&tw({...tp,email:tp.email})},onShippingPhoneChange:e=>ty(t=>({...t,phone:e})),onBillingPhoneChange:e=>{tw(t=>({...t,phone:e}))},meData:tF,formData:tk,setFormData:tN,selectedAddressId:tq,setSelectedAddressId:e=>{tB(e),tH(!0),eb(null),eE(!1),er&&er.includes("No delivery methods found")&&(ea(null),td.current="",tu.current=0,tl.current=!1,ee([]))},selectedBillingAddressId:tG,setSelectedBillingAddressId:tJ,onAddressAdded:async()=>{await t_()},onSetDefaultAddress:tY}),eG.length>0&&(0,r.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-orange-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-orange-800 mb-3 uppercase tracking-wide",children:["Shipping Restriction",eG.length>1?"s":""," Detected"]}),(0,r.jsx)("div",{className:"space-y-4",children:eG.map((e,t)=>(0,r.jsxs)("div",{className:"bg-white border border-orange-100 rounded p-3",children:[(0,r.jsx)("p",{className:"font-medium text-orange-900 text-sm",children:e.productName}),(0,r.jsx)("p",{className:"text-orange-700 text-sm mt-1",children:e.checkoutMessage})]},t))}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-orange-100 rounded border border-orange-200",children:(0,r.jsx)("p",{className:"text-sm text-orange-800 font-medium",children:"Please update your shipping address or remove the restricted item(s) to continue."})})]})]})}),!eV&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p,{checkoutId:i,canShowDeliveryMethods:!!tQ,hasCompleteShippingInfo:!!tK,missingForDelivery:tx,shippingLoading:et,shippingMethods:W,shippingError:er,selectedShippingId:el,isUpdatingDelivery:ew||ej,isProcessingSelection:eu,isWillCallSelected:te,onShippingMethodSelect:async e=>{eh(!0);try{if(te&&i)try{if((!W.find(t=>t.id===e)||0===W.length)&&(en(!0),ea(null),t8.current=null,!(await t0(i)).find(t=>t.id===e))){ea("The selected shipping method is no longer available. Please select a different method."),eh(!1);return}}catch(e){console.error("Failed to fetch fresh shipping methods:",e),ea("Failed to load shipping methods. Please try again."),eh(!1);return}finally{en(!1)}else if(!W.find(t=>t.id===e)){ea("The selected shipping method is no longer available. Please refresh the page and select a different method."),eh(!1);return}ei(e),b(e),ed(!0),tt(!1),e9(null),er&&(er.includes("click and collect")||er.includes("warehouse address"))&&ea(null)}finally{eh(!1)}},onRetryShippingMethods:t2}),(0,r.jsx)(L,{checkoutId:i,willCallEnabled:H(),collectionPoints:e6,selectedCollectionPointId:e7,isUpdatingDelivery:ew||ej,isProcessingSelection:eu,onCollectionPointSelect:t5,userState:tp.state,willCallLoading:tn,willCallError:ta})]}),i&&ns&&!eN&&(el&&ec||te&&e7)&&!eV&&(0,r.jsx)(z,{isLoggedIn:a,grandTotal:nt,checkoutId:i,onQuestionsChange:eF,onValidationChange:eR,onSaveQuestions:e=>eL(()=>e)}),i&&(0,r.jsx)(O,{onBack:()=>{},onComplete:na,totalAmount:ns||0,checkoutId:i,availablePaymentGateways:null==tR||null==(e=tR.checkout)?void 0:e.availablePaymentGateways,kountConfig:e0,taxInfo:ex,isCalculatingTotal:eN,disabled:eN||eV||!(el&&ec||te&&e7),onPaymentReady:no,onStartPayment:async()=>{var e;if((null==to||null==(e=to.page)?void 0:e.isPublished)&&!eO)throw Error("Please accept the Terms and Conditions to continue.");if(await t9(!0),e$&&"function"==typeof e$)try{await e$()}catch(e){console.error("Failed to save checkout questions:",e)}},isProcessingPayment:ey,setIsProcessingPayment:eg,selectedShippingId:el||void 0,userEmail:null==k?void 0:k.email,guestEmail:tp.email,lineItems:t,questionsValid:e_,termsAccepted:eO,termsData:to,onTermsModalOpen:()=>eB(!0),onTermsAcceptedChange:ez,billingAddress:(()=>{let e=em?tp:tb;if(e.firstName&&e.lastName&&e.address&&e.city&&e.zipCode)return{firstName:e.firstName||"",lastName:e.lastName||"",address:e.address||"",city:e.city||"",state:e.state||"",zipCode:e.zipCode||"",country:e.country||"US",phone:e.phone||void 0}})(),shippingAddress:(()=>{if(eT&&eM){var e;return{firstName:"Dealer",lastName:"Pickup",address:eM.address.streetAddress1||"",city:eM.address.city||"",state:eM.address.countryArea||"",zipCode:eM.address.postalCode||"",country:(null==(e=eM.address.country)?void 0:e.code)||"US",phone:eM.phone||void 0,dealerName:eM.name}}if(tp.firstName&&tp.lastName&&tp.address&&tp.city&&tp.zipCode)return{firstName:tp.firstName||"",lastName:tp.lastName||"",address:tp.address||"",city:tp.city||"",state:tp.state||"",zipCode:tp.zipCode||"",country:tp.country||"US",phone:tp.phone||void 0}})()})]}),(0,r.jsx)(f,{totalAmount:n,selectedShipping:ne,grandTotal:nt,saleorTotal:ef,isUpdatingDelivery:ew,shippingLoading:et,isCalculatingTotal:eN,taxInfo:ex,isCalculatingTax:eS,voucherInfo:eY,onApplyVoucher:tT,onRemoveVoucher:tD,isApplyingVoucher:eX,voucherError:eQ,selectedCollectionPointId:e7,onCompletePayment:eI.fn||void 0,isPaymentProcessing:ey.isModalOpen,paymentDisabled:eN||eV||!(el&&ec||te&&e7),paymentDisabledReason:eN?"Calculating total...":eV?"Please resolve product restrictions":"Select a delivery method"})]}),(0,r.jsx)(q,{isModalOpen:eq,onClose:()=>eB(!1)})]}):(0,r.jsx)(T.A,{className:"h-[80vh]",text:"Your cart is empty",buttonLabel:"Continue Shopping",onClick:()=>K.push("/")}):(0,r.jsx)(D.A,{className:"h-[80vh]"})}},87509:(e,t,n)=>{"use strict";n.d(t,{H:()=>a});var r=n(54568);let a=(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",focusable:"false",children:[(0,r.jsxs)("g",{clipPath:"url(#clip0_673_17)",children:[(0,r.jsx)("path",{d:"M3.125 10H16.875",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M11.25 4.375L16.875 10L11.25 15.625",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:"clip0_673_17",children:(0,r.jsx)("rect",{width:20,height:20,fill:"currentColor"})})})]})}},e=>{e.O(0,[7261,8745,4398,7537,1773,367,2244,7948,2417,7366,6806,587,1902,7358],()=>e(e.s=2890)),_N_E=e.O()}]);